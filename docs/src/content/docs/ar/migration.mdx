---
title: ุฏููู ุงูุชุฑููุฉ (Migration Guide)
description: ุงูุชุฑููุฉ ุฅูู ุฃุญุฏุซ ุฅุตุฏุงุฑ ูุณุชูุฑ ูู Bloc.
---

import { Code, Tabs, TabItem } from '@astrojs/starlight/components';

:::tip

ูุฑุฌู ุงูุฑุฌูุน ุฅูู [ุณุฌู ุงูุฅุตุฏุงุฑุงุช](https://github.com/felangel/bloc/releases)
ููุงุทูุงุน ุนูู ุชูุงุตูู ุงูุชุบููุฑุงุช ูู ูู ุฅุตุฏุงุฑ.

:::

## v10.0.0

### `package:bloc_test`

#### โโจ ูุตู `blocTest` ุนู `BlocBase`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุฅุตุฏุงุฑ bloc_test v10.0.0ุ ูู ูุนุฏ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (API) ูู `blocTest`
ูุฑุชุจุทุฉ ุจุดูู ูุซูู ุจู `BlocBase`.

:::

##### ุงูุฃุณุจุงุจ (Rationale)

ูุฌุจ ุฃู ูุณุชุฎุฏู `blocTest` ูุงุฌูุงุช bloc ุงูุฃุณุงุณูุฉ ูููุง ุฃููู ุฐูู ูุฒูุงุฏุฉ ุงููุฑููุฉ
ููุงุจููุฉ ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู. ุณุงุจูุงูุ ูู ููู ูุฐุง ููููุงู ูุฃู `BlocBase` ูุงู ูุทุจู
`StateStreamableSource` ููู ูุง ูู ููู ูุงููุงู ูู `blocTest` ุจุณุจุจ ุงูุงุนุชูุงุฏ ุงูุฏุงุฎูู
ุนูู API ุงูู `emit`.

### `package:hydrated_bloc`

#### โโจ ุฏุนู WebAssembly

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุฅุตุฏุงุฑ hydrated_bloc v10.0.0ุ ุชูุช ุฅุถุงูุฉ ุฏุนู ููุชุฑุฌูุฉ ุงูุจุฑูุฌูุฉ (compiling) ุฅูู
WebAssembly (wasm).

:::

##### ุงูุฃุณุจุงุจ (Rationale)

ุณุงุจูุงูุ ูู ููู ูู ุงููููู ุชุฑุฌูุฉ ุงูุชุทุจููุงุช ุฅูู wasm ุนูุฏ ุงุณุชุฎุฏุงู `hydrated_bloc`.
ูู ุงูุฅุตุฏุงุฑ v10.0.0ุ ุชูุช ุฅุนุงุฏุฉ ููููุฉ ุงูุญุฒูุฉ ููุณูุงุญ ุจุงูุชุฑุฌูุฉ ุฅูู wasm.

**v9.x.x**

```dart
Future<void> main() async {
  WidgetsFlutterBinding.ensureInitialized();
  HydratedBloc.storage = await HydratedStorage.build(
    storageDirectory: kIsWeb
        ? HydratedStorage.webStorageDirectory
        : await getTemporaryDirectory(),
  );
  runApp(App());
}
```

**v10.x.x**

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  HydratedBloc.storage = await HydratedStorage.build(
    storageDirectory: kIsWeb
        ? HydratedStorageDirectory.web
        : HydratedStorageDirectory((await getTemporaryDirectory()).path),
  );
  runApp(const App());
}
```

## v9.0.0

### `package:bloc`

#### โ๐งน ุฅุฒุงูุฉ ุงููุงุฌูุงุช ุงูููุฌูุฑุฉ

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v9.0.0ุ ุชูุช ุฅุฒุงูุฉ ุฌููุน ุงููุงุฌูุงุช ุงูุชู ุชู ุงูุฅุนูุงู ุนููุง ุณุงุจููุง ูู
"ููุฌูุฑุฉ" (deprecated).

:::

##### ููุฎุต

- ุชูุช ุฅุฒุงูุฉ `BlocOverrides` ูุงุณุชุจุฏุงูู ุจู `Bloc.observer` ู `Bloc.transformer`.

#### โโจ ุชูุฏูู ูุงุฌูุฉ `EmittableStateStreamableSource`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ูุฐุง ุงูุฅุตุฏุงุฑุ ุชู ุชูุฏูู ูุงุฌูุฉ ุฃุณุงุณูุฉ ุฌุฏูุฏุฉ ุจุงุณู
`EmittableStateStreamableSource`.

:::

##### ุงูุณุจุจ

ูุงู `package:bloc_test` ูุฑุชุจุทูุง ุจุดูู ูุจุงุดุฑ ุจู `BlocBase`. ุชู ุชูุฏูู ูุฐู ุงููุงุฌูุฉ
ููุตู `blocTest` ุนู ุงูุชูููุฐ ุงููุนูู ูู `BlocBase`.

### `package:hydrated_bloc`

#### โจ ุฅุนุงุฏุฉ ุชูุฏูู `HydratedBloc.storage`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ hydrated_bloc v9.0.0ุ ุชูุช ุฅุฒุงูุฉ `HydratedBlocOverrides` ูุงุณุชุจุฏุงูู
ุจุงุณุชุฎุฏุงู `HydratedBloc.storage`.

:::

##### ุงูุณุจุจ

ุฑุงุฌุน:
[ุณุจุจ ุฅุนุงุฏุฉ ุชูุฏูู Bloc.observer ู Bloc.transformer](/ar/migration/#-ุฅุนุงุฏุฉ-ุชูุฏูู-blocobserver-ู-bloctransformer)

**v8.x.x**

```dart
Future<void> main() async {
  final storage = await HydratedStorage.build(
    storageDirectory: kIsWeb
        ? HydratedStorage.webStorageDirectory
        : await getTemporaryDirectory(),
  );
  HydratedBlocOverrides.runZoned(
    () => runApp(App()),
    storage: storage,
  );
}
```

**v9.0.0**

```dart
Future<void> main() async {
  WidgetsFlutterBinding.ensureInitialized();
  HydratedBloc.storage = await HydratedStorage.build(
    storageDirectory: kIsWeb
        ? HydratedStorage.webStorageDirectory
        : await getTemporaryDirectory(),
  );
  runApp(App());
}
```

## v8.1.0

### `package:bloc`

#### โจ ุฅุนุงุฏุฉ ุชูุฏูู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช `Bloc.observer` ู `Bloc.transformer`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุฅุตุฏุงุฑ bloc v8.1.0ุ ุชู ูุถุน ุนูุงูุฉ "ููุฌูุฑ" ุนูู `BlocOverrides` ูุตุงูุญ ูุงุฌูุงุช
`Bloc.observer` ู `Bloc.transformer`.

:::

##### ุงูุฃุณุจุงุจ (Rationale)

ุชู ุชูุฏูู API ุงูู `BlocOverrides` ูู ุงูุฅุตุฏุงุฑ v8.0.0 ูู ูุญุงููุฉ ูุฏุนู ูุทุงู (scoping)
ุฅุนุฏุงุฏุงุช ุงูู bloc ุงููุญุฏุฏุฉ ูุซู `BlocObserver` ู `EventTransformer` ู
`HydratedStorage`. ูู ุชุทุจููุงุช Dart ุงูุตุฑูุฉุ ุนููุช ุงูุชุบููุฑุงุช ุจุดูู ุฌูุฏุ ููุน ุฐููุ ูู
ุชุทุจููุงุช Flutterุ ุชุณุจุจ API ุงูุฌุฏูุฏ ูู ูุดุงูู ุฃูุซุฑ ููุง ุญููุง.

ุชู ุงุณุชููุงู API ุงูู `BlocOverrides` ูู ูุงุฌูุงุช ููุงุซูุฉ ูู Flutter/Dart:

- [HttpOverrides](https://api.flutter.dev/flutter/dart-io/HttpOverrides-class.html)
- [IOOverrides](https://api.flutter.dev/flutter/dart-io/IOOverrides-class.html)

**ุงููุดุงูู**

ุนูู ุงูุฑุบู ูู ุฃูู ูู ููู ุงูุณุจุจ ุงูุฑุฆูุณู ููุฐู ุงูุชุบููุฑุงุชุ ุฅูุง ุฃู API ุงูู
`BlocOverrides` ุฃุถุงู ุชุนููุฏุงู ุฅุถุงููุงู ูููุทูุฑูู. ูุจุงูุฅุถุงูุฉ ุฅูู ุฒูุงุฏุฉ ููุฏุงุฑ ุงูุชุฏุงุฎู
(nesting) ูุนุฏุฏ ุฃุณุทุฑ ุงูููุฏ ุงููุงุฒูุฉ ูุชุญููู ููุณ ุงูุชุฃุซูุฑุ ุชุทูุจ API ุงูู
`BlocOverrides` ูู ุงููุทูุฑูู ุฃู ูููู ูุฏููู ููู ููู ููู
[Zones](https://api.dart.dev/stable/2.17.6/dart-async/Zone-class.html) ูู Dart.
ุงูู `Zones` ููุณุช ูููููุงู ุณููุงู ูููุจุชุฏุฆููุ ูุงููุดู ูู ููู ููููุฉ ุนูููุง ูุฏ ูุคุฏู ุฅูู
ุธููุฑ ุฃุฎุทุงุก (ูุซู ุนุฏู ุชููุฆุฉ ุงููุฑุงูุจููุ ุงููุญููุงุชุ ุฃู ูุซููุงุช ุงูุชุฎุฒูู).

ุนูู ุณุจูู ุงููุซุงูุ ูุงู ูุฏู ุงูุนุฏูุฏ ูู ุงููุทูุฑูู ููุฏ ูุซู:

```dart
void main() {
  WidgetsFlutterBinding.ensureInitialized();
  BlocOverrides.runZoned(...);
}
```

ุงูููุฏ ุฃุนูุงู ูุฏ ูุจุฏู ุจุณูุทูุง ูุบูุฑ ุถุงุฑุ ูููู ูุฏ ูุคุฏู ูุนูููุง ุฅูู ุฃุฎุทุงุก ูุตุนุจ ุชุชุจุนูุง.

ุงูู Zone ุงูุชู ูุชู ุงุณุชุฏุนุงุก `WidgetsFlutterBinding.ensureInitialized` ูููุง ูู
ุงูุจุฏุงูุฉ ุณุชููู ูู ููุณูุง ุงููุณุชุฎุฏูุฉ ููุนุงูุฌุฉ ุฃุญุฏุงุซ ุงููุงุฌูุฉ (ูุซู `onTap` ู
`onPressed`) ูุฐูู ุจุณุจุจ `GestureBinding.initInstances`.

ููุฐุง ูุฌุฑุฏ ูุซุงู ูุงุญุฏ ูู ุงูุนุฏูุฏ ูู ุงููุดุงูู ุงููุงุชุฌุฉ ุนู ุงุณุชุฎุฏุงู `zoneValues`.

ุจุงูุฅุถุงูุฉ ุฅูู ุฐููุ ูููู Flutter ุจุงูุนุฏูุฏ ูู ุงูุนูููุงุช ุฎูู ุงูููุงููุณ ุงูุชู ุชุชุถูู ุฅูุดุงุก
ุฃู ุชุนุฏูู ุงูู Zones (ุฎุตูุตูุง ุฃุซูุงุก ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช)ุ ููุง ูุฏ ูุคุฏู ุฅูู ุณููู ุบูุฑ
ูุชููุนุ ููู ุจุนุถ ุงูุญุงูุงุช ุณููู ุฎุงุฑุฌ ุนู ุณูุทุฑุฉ ุงููุทูุฑ (ุงูุธุฑ ุงููุดุงูู ุฃุฏูุงู).

ุจุณุจุจ ุงุณุชุฎุฏุงู
[runZoned](https://api.flutter.dev/flutter/dart-async/runZoned.html)ุ ุฃุฏู
ุงูุงูุชูุงู ุฅูู `BlocOverrides` ุฅูู ุงูุชุดุงู ุนุฏุฉ ูุดุงูู ููููุฏ ูู Flutterุ ุฎุงุตุฉ ูู
ุงุฎุชุจุงุฑุงุช Widget ู Integration:

- https://github.com/flutter/flutter/issues/96939
- https://github.com/flutter/flutter/issues/94123
- https://github.com/flutter/flutter/issues/93676

ููุง ุฃุซุฑุช ูุฐู ุงููุดุงูู ุนูู ุงูุนุฏูุฏ ูู ูุณุชุฎุฏูู ููุชุจุฉ bloc:

- https://github.com/felangel/bloc/issues/3394
- https://github.com/felangel/bloc/issues/3350
- https://github.com/felangel/bloc/issues/3319

**v8.0.x**

```dart
void main() {
  BlocOverrides.runZoned(
    () {
      // ...
    },
    blocObserver: CustomBlocObserver(),
    eventTransformer: customEventTransformer(),
  );
}
```

**v8.1.0**

```dart
void main() {
  Bloc.observer = CustomBlocObserver();
  Bloc.transformer = customEventTransformer();

  // ...
}
```

## v8.0.0

### `package:bloc`

#### โโจ ุชูุฏูู `BlocOverrides`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v8.0.0ุ ุชูุช ุฅุฒุงูุฉ `Bloc.observer` ู `Bloc.transformer`
ูุงุณุชุจุฏุงูููุง ุจู `BlocOverrides`.

:::

##### ุงูุณุจุจ

ูุงู ุงูููุฌ ุงูุณุงุจู ูุชุฌุงูุฒ `BlocObserver` ู `EventTransformer` ูุนุชูุฏ ุนูู singleton
ุนุงู ููู ููููุง.

ููุชูุฌุฉ ูุฐููุ ูู ููู ูู ุงููููู:

- ุงุณุชุฎุฏุงู ุนุฏุฉ ุชุทุจููุงุช ูุฎุชููุฉ ูู `BlocObserver` ุฃู `EventTransformer` ุถูู ุฃุฌุฒุงุก
  ูุฎุชููุฉ ูู ุงูุชุทุจูู
- ุญุตุฑ (scoping) ูุฐู ุงูุฅุนุฏุงุฏุงุช ุฏุงุฎู ุญุฒูุฉ (package) ูุนููุฉ
  - ูู ุญุงู ูุงูุช ุญุฒูุฉ ุชุนุชูุฏ ุนูู `package:bloc` ุจุชุณุฌูู `BlocObserver` ุฎุงุต ุจูุงุ
    ุณููุฌุจุฑ ุงููุณุชุฎุฏู ุฅูุง ุนูู ุงุณุชุจุฏุงูู ุฃู ุงูุชุนุงูู ูุนู ููุง ูู

ููุง ุฃู ูุฐุง ุงูููุฌ ุฌุนู ุนูููุฉ ุงูุงุฎุชุจุงุฑ ุฃูุซุฑ ุตุนูุจุฉ ุจุณุจุจ ูุฌูุฏ ุญุงูุฉ ุนุงูุฉ ูุดุชุฑูุฉ ุจูู
ุงูุงุฎุชุจุงุฑุงุช.

ููุฏู ุงูุฅุตุฏุงุฑ v8.0.0 ูุฆุฉ `BlocOverrides` ุงูุชู ุชุชูุญ ูููุทูุฑูู ุชุฎุตูุต `BlocObserver`
ู/ุฃู `EventTransformer` ุถูู `Zone` ูุญุฏุฏุฉุ ุจุฏูุงู ูู ุงูุงุนุชูุงุฏ ุนูู singleton ุนุงู
ูุงุจู ููุชุบููุฑ.

**v7.x.x**

```dart
void main() {
  Bloc.observer = CustomBlocObserver();
  Bloc.transformer = customEventTransformer();

  // ...
}
```

**v8.0.0**

```dart
void main() {
  BlocOverrides.runZoned(
    () {
      // ...
    },
    blocObserver: CustomBlocObserver(),
    eventTransformer: customEventTransformer(),
  );
}
```

ุณุชุณุชุฎุฏู ูุงุฆูุงุช `Bloc` ูููุง ูู `BlocObserver` ู/ุฃู `EventTransformer` ุงูุฎุงุตุฉ ุจุงูู
`Zone` ุงูุญุงููุฉ ุนุจุฑ `BlocOverrides.current`. ูู ุญุงู ุนุฏู ูุฌูุฏ `BlocOverrides` ููุฐู
ุงูู `Zone`ุ ุณูุชู ุงุณุชุฎุฏุงู ุงูููู ุงูุงูุชุฑุงุถูุฉ ุงูุฏุงุฎููุฉ (ุฏูู ุฃู ุชุบููุฑ ูู ุงูุณููู ุฃู
ุงููุธุงุฆู).

ูุณูุญ ุฐูู ููู `Zone` ุจุงูุนูู ุจุดูู ูุณุชูู ุจุงุณุชุฎุฏุงู `BlocOverrides` ุงูุฎุงุตุฉ ุจูุง.

```dart
BlocOverrides.runZoned(
  () {
    // BlocObserverA and eventTransformerA
    final overrides = BlocOverrides.current;

    // Blocs in this zone report to BlocObserverA
    // and use eventTransformerA as the default transformer.
    // ...

    // Later...
    BlocOverrides.runZoned(
      () {
        // BlocObserverB and eventTransformerB
        final overrides = BlocOverrides.current;

        // Blocs in this zone report to BlocObserverB
        // and use eventTransformerB as the default transformer.
        // ...
      },
      blocObserver: BlocObserverB(),
      eventTransformer: eventTransformerB(),
    );
  },
  blocObserver: BlocObserverA(),
  eventTransformer: eventTransformerA(),
);
```

#### โโจ ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุงูุฅุจูุงุบ ุนููุง

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v8.0.0ุ ุชูุช ุฅุฒุงูุฉ `BlocUnhandledErrorException`.

ููุง ูุชู ุงูุขู ุฏุงุฆููุง ุงูุฅุจูุงุบ ุนู ุฃู ุงุณุชุซูุงุก ุบูุฑ ููุนุงูุฌ ุฅูู `onError` ุซู ุฅุนุงุฏุฉ ุฑููู
(ุจุบุถ ุงููุธุฑ ุนู ูุถุน debug ุฃู release).

ุฃูุง `addError`ุ ููููู ุจุงูุฅุจูุงุบ ุนู ุงูุฃุฎุทุงุก ุฅูู `onError`ุ ูููู ูุง ูุนุชุจุฑ ูุฐู
ุงูุฃุฎุทุงุก ุงุณุชุซูุงุกุงุช ุบูุฑ ููุนุงูุฌุฉ.

:::

##### ุงูุณุจุจ

ุชูุฏู ูุฐู ุงูุชุบููุฑุงุช ุฅูู:

- ุฌุนู ุงูุงุณุชุซูุงุกุงุช ุบูุฑ ุงูููุนุงูุฌุฉ ูุงุถุญุฉ ุจุดูู ุฃูุจุฑ ูุน ุงูุญูุงุธ ุนูู ุงุณุชูุฑุงุฑ bloc
- ุฏุนู ุงุณุชุฎุฏุงู `addError` ุฏูู ุงูุชุฃุซูุฑ ุนูู ุชุฏูู ุงูุชูููุฐ

ุณุงุจููุงุ ูุงู ุณููู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุฎุชูู ุจูู ูุถุนู debug ู release.

ููุง ุฃู ุงูุฃุฎุทุงุก ุงูููุจูุบ ุนููุง ุนุจุฑ `addError` ูุงูุช ุชูุนุงูู ูุงุณุชุซูุงุกุงุช ุบูุฑ ููุนุงูุฌุฉ ูู
ูุถุน debugุ ููุง ูุงู ูุคุฏู ุฅูู ุชุฌุฑุจุฉ ุบูุฑ ุฌูุฏุฉ ูููุทูุฑูู (ุฎุตูุตูุง ุนูุฏ ูุชุงุจุฉ ุงุฎุชุจุงุฑุงุช
ุงููุญุฏุฉ).

ูู ุงูุฅุตุฏุงุฑ v8.0.0ุ ูููู ุงุณุชุฎุฏุงู `addError` ุจุฃูุงู ููุฅุจูุงุบ ุนู ุงูุฃุฎุทุงุกุ ููุง ูููู
ุงุณุชุฎุฏุงู `blocTest` ููุชุญูู ูู ุฐูู.

ูุง ุชุฒุงู ุฌููุน ุงูุฃุฎุทุงุก ุชูุฑุณู ุฅูู `onError`ุ ูููู ูุชู ุฅุนุงุฏุฉ ุฑูู ุงูุงุณุชุซูุงุกุงุช ุบูุฑ
ุงูููุนุงูุฌุฉ ููุท (ุจุบุถ ุงููุธุฑ ุนู ูุถุน ุงูุชุดุบูู).

#### โ๐งน ุฌุนู `BlocObserver` ูุฆุฉ ูุฌุฑุฏุฉ

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v8.0.0ุ ุชู ุชุญููู `BlocObserver` ุฅูู ูุฆุฉ `abstract`ุ ููุง ูุนูู ุฃูู
ูุง ูููู ุฅูุดุงุก instance ูููุง ูุจุงุดุฑุฉ.

:::

##### ุงูุณุจุจ

ุชู ุชุตููู `BlocObserver` ููููู ุจูุซุงุจุฉ ูุงุฌูุฉ (interface).

ูุจูุง ุฃู ุงูุชูููุฐ ุงูุงูุชุฑุงุถู ูุง ูุญุชูู ุนูู ุฃู ุณููู (no-op)ุ ููุฏ ุชู ุชุญูููู ุฅูู ูุฆุฉ
`abstract` ูุชูุถูุญ ุฃูู ูุฎุตุต ููุชูุณูุน (extension) ูููุณ ููุงุณุชุฎุฏุงู ุงููุจุงุดุฑ.

```dart
void main() {
  // ูุงู ูู ุงููููู ุฅูุดุงุก ูุซูู ูู ุงููุฆุฉ ุงูุฃุณุงุณูุฉ.
final observer = BlocObserver();
}

```

**v8.0.0**

```dart
class MyBlocObserver extends BlocObserver {...}

void main() {
  // ูุง ูููู ุฅูุดุงุก ูุซูู ูู ุงููุฆุฉ ุงูุฃุณุงุณูุฉ.
  final observer = BlocObserver(); // ุฎุทุฃ (ERROR)

  // ูู ุจุชูุณูุน `BlocObserver` ุจุฏูุงู ูู ุฐูู.
  final observer = MyBlocObserver(); // ููุจูู (OK)
}
```

#### โโจ ุงุณุชุฏุนุงุก `add` ูุฑูู `StateError` ุนูุฏ ุฅุบูุงู ุงูู Bloc

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v8.0.0ุ ูุคุฏู ุงุณุชุฏุนุงุก `add` ุนูู Bloc ูุบูู ุฅูู ุฑูู `StateError`.

:::

##### ุงูุณุจุจ

ุณุงุจููุงุ ูุงู ูู ุงููููู ุงุณุชุฏุนุงุก `add` ุนูู Bloc ูุบููุ ููุงู ุงูุฎุทุฃ ุงูุฏุงุฎูู ูุชู
ุชุฌุงูููุ ููุง ูุฌุนู ูู ุงูุตุนุจ ูุนุฑูุฉ ุณุจุจ ุนุฏู ูุนุงูุฌุฉ ุงูุญุฏุซ.

ูุฌุนู ูุฐุง ุงูุณููุงุฑูู ุฃูุซุฑ ูุถูุญูุงุ ูู v8.0.0ุ ูุคุฏู ุงุณุชุฏุนุงุก `add` ุนูู Bloc ูุบูู ุฅูู
ุฑูู `StateError`ุ ููุชู ุงูุชุนุงูู ูุนู ูุงุณุชุซูุงุก ุบูุฑ ููุนุงูุฌ ููุชู ุชูุฑูุฑู ุฅูู
`onError`.

#### โโจ ุงุณุชุฏุนุงุก `emit` ูุฑูู `StateError` ุนูุฏ ุฅุบูุงู ุงูู Bloc

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v8.0.0ุ ูุคุฏู ุงุณุชุฏุนุงุก `emit` ุฏุงุฎู Bloc ูุบูู ุฅูู ุฑูู `StateError`.

:::

##### ุงูุณุจุจ

ุณุงุจููุงุ ูุงู ูู ุงููููู ุงุณุชุฏุนุงุก `emit` ุฏุงุฎู Bloc ูุบูู ุฏูู ุญุฏูุซ ุฃู ุชุบููุฑ ูู ุงูุญุงูุฉุ
ูุฏูู ูุฌูุฏ ุฃู ูุคุดุฑ ุนูู ุงูุฎุทุฃุ ููุง ูุฌุนู ุนูููุฉ ุงูุชุตุญูุญ ุตุนุจุฉ.

ูุฌุนู ูุฐุง ุงูุณููู ุฃูุซุฑ ูุถูุญูุงุ ูู v8.0.0ุ ูุคุฏู ุงุณุชุฏุนุงุก `emit` ุฏุงุฎู Bloc ูุบูู ุฅูู
ุฑูู `StateError`ุ ููุชู ุงูุชุนุงูู ูุนู ูุงุณุชุซูุงุก ุบูุฑ ููุนุงูุฌ ููุชู ุชูุฑูุฑู ุฅูู
`onError`.

#### โ๐งน ุฅุฒุงูุฉ ุงููุงุฌูุงุช ุงูููุฌูุฑุฉ

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v8.0.0ุ ุชูุช ุฅุฒุงูุฉ ุฌููุน ุงููุงุฌูุงุช ุงูุชู ุชู ุงูุฅุนูุงู ุนููุง ุณุงุจููุง ูู
ููุฌูุฑุฉ (deprecated).

:::

##### ููุฎุต

- ุชูุช ุฅุฒุงูุฉ `mapEventToState` ูุงุณุชุจุฏุงูู ุจู `on<Event>`
- ุชูุช ุฅุฒุงูุฉ `transformEvents` ูุงุณุชุจุฏุงูู ุจู `EventTransformer`
- ุชูุช ุฅุฒุงูุฉ `TransitionFunction` ูุงุณุชุจุฏุงูู ุจู `EventTransformer`
- ุชูุช ุฅุฒุงูุฉ `listen` ูุงุณุชุจุฏุงูู ุจู `stream.listen`

### `package:bloc_test`

#### โจ ูู ูุนุฏ `MockBloc` ู `MockCubit` ูุชุทูุจุงู `registerFallbackValue`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc_test v9.0.0ุ ูู ูุนุฏ ูู ุงูุถุฑูุฑู ุงุณุชุฏุนุงุก `registerFallbackValue`
ุนูุฏ ุงุณุชุฎุฏุงู `MockBloc` ุฃู `MockCubit`.

:::

##### ููุฎุต

ููุณุชุฎุฏู `registerFallbackValue` ููุท ุนูุฏ ุงุณุชุฎุฏุงู `any()` ูู `package:mocktail` ูุน
ุฃููุงุน ูุฎุตุตุฉ.

ุณุงุจููุงุ ูุงู ูุฌุจ ุงุณุชุฏุนุงุคู ููู `Event` ู `State` ุนูุฏ ุงุณุชุฎุฏุงู `MockBloc` ุฃู
`MockCubit`.

**v8.x.x**

```dart
class FakeMyEvent extends Fake implements MyEvent {}
class FakeMyState extends Fake implements MyState {}
class MyMockBloc extends MockBloc<MyEvent, MyState> implements MyBloc {}

void main() {
  setUpAll(() {
    registerFallbackValue(FakeMyEvent());
    registerFallbackValue(FakeMyState());
  });

  // ุงูุงุฎุชุจุงุฑุงุช...
}
```

**v9.0.0**

```dart
class MyMockBloc extends MockBloc<MyEvent, MyState> implements MyBloc {}

void main() {
  // ุงูุงุฎุชุจุงุฑุงุช...
}
```

### `package:hydrated_bloc`

#### โโจ ุชูุฏูู `HydratedBlocOverrides`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ hydrated_bloc v8.0.0ุ ุชูุช ุฅุฒุงูุฉ `HydratedBloc.storage` ูุงุณุชุจุฏุงูู ุจู
`HydratedBlocOverrides`.

:::

##### ุงูุณุจุจ

ุณุงุจููุงุ ูุงู ูุชู ุงูุงุนุชูุงุฏ ุนูู singleto ุนุงู ูุชุฎุตูุต ุชูููุฐ `Storage`.

ููุชูุฌุฉ ูุฐููุ ูู ููู ูู ุงููููู ุงุณุชุฎุฏุงู ุฃูุซุฑ ูู ุชูููุฐ ูู `Storage` ุถูู ุฃุฌุฒุงุก
ูุฎุชููุฉ ูู ุงูุชุทุจูู.

ููุง ุฃู ูุฐุง ุงูููุฌ ุฌุนู ุงูุงุฎุชุจุงุฑุงุช ุฃูุซุฑ ุตุนูุจุฉ ุจุณุจุจ ูุฌูุฏ ุญุงูุฉ ุนุงูุฉ ูุดุชุฑูุฉ ุจูู
ุงูุงุฎุชุจุงุฑุงุช.

ููุฏู ุงูุฅุตุฏุงุฑ v8.0.0 ูุฆุฉ `HydratedBlocOverrides` ุงูุชู ุชุชูุญ ูููุทูุฑูู ุชุฎุตูุต
`Storage` ุถูู `Zone` ูุญุฏุฏุฉุ ุจุฏูุงู ูู ุงูุงุนุชูุงุฏ ุนูู singleton ุนุงู ูุงุจู ููุชุบููุฑ.

**v7.x.x**

```dart
void main() async {
  HydratedBloc.storage = await HydratedStorage.build(
    storageDirectory: await getApplicationSupportDirectory(),
  );

  // ...
}
```

**v8.0.0**

```dart
void main() {
  final storage = await HydratedStorage.build(
    storageDirectory: await getApplicationSupportDirectory(),
  );

  HydratedBlocOverrides.runZoned(
    () {
      // ...
    },
    storage: storage,
  );
}
```

ุณุชุณุชุฎุฏู ูุงุฆูุงุช `HydratedBloc` ุงูู `Storage` ุงูุฎุงุตุฉ ุจุงูู `Zone` ุงูุญุงููุฉ ุนุจุฑ
`HydratedBlocOverrides.current`.

ูุณูุญ ุฐูู ููู `Zone` ุจุงูุนูู ุจุดูู ูุณุชูู ุจุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงูุฎุงุตุฉ ุจูุง.

## v7.2.0

### `package:bloc`

#### โจ ุชูุฏูู `on<Event>`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v7.2.0ุ ุชู ุฅููุงู ุงุณุชุฎุฏุงู `mapEventToState` (deprecated)
ูุงุณุชุจุฏุงูู ุจู `on<Event>`. ูุณูุชู ุฅุฒุงูุฉ `mapEventToState` ูู ุงูุฅุตุฏุงุฑ v8.0.0.

:::

##### ุงูุณุจุจ

ุชู ุชูุฏูู `on<Event>` ูุฌุฒุก ูู:
[ููุชุฑุญ: ุงุณุชุจุฏุงู mapEventToState ุจู `on<Event>` ูู Bloc](https://github.com/felangel/bloc/issues/2526).

ุจุณุจุจ [ูุดููุฉ ูู Dart](https://github.com/dart-lang/sdk/issues/44616)ุ ูุฏ ูุง ูููู
ูู ุงููุงุถุญ ุฏุงุฆููุง ูุง ุณุชููู ุนููู ูููุฉ `state` ุนูุฏ ุงูุชุนุงูู ูุน ูููุฏุงุช ุบูุฑ ูุชุฒุงููุฉ
ูุชุฏุงุฎูุฉ (`async*`).

ุนูู ุงูุฑุบู ูู ูุฌูุฏ ุญููู ุจุฏููุฉุ ุฅูุง ุฃู ุฃุญุฏ ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ ูููุชุจุฉ bloc ูู
ุงููุงุจููุฉ ููุชูุจุค.

ูุฐููุ ุชู ุชูุฏูู `on<Event>` ูุฌุนู ุงุณุชุฎุฏุงู ุงูููุชุจุฉ ุฃูุซุฑ ุฃูุงููุง ูุชูููู ุฃู ุบููุถ ูุชุนูู
ุจุชุบููุฑ ุงูุญุงูุฉ.

:::tip

ููุฒูุฏ ูู ุงูุชูุงุตูู:
[ุงูุฑุฃ ุงูููุชุฑุญ ุงููุงูู](https://github.com/felangel/bloc/issues/2526)

:::

##### ููุฎุต

ูุชูุญ ูู `on<E>` ุชุณุฌูู ูุนุงูุฌ ุฃุญุฏุงุซ ูุฌููุน ุงูุฃุญุฏุงุซ ูู ุงูููุน `E`.

ุจุดูู ุงูุชุฑุงุถูุ ุชุชู ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ ุจุดูู ูุชูุงุฒู (concurrently) ุนูุฏ ุงุณุชุฎุฏุงู `on<E>`ุ
ุนูู ุนูุณ `mapEventToState` ุงูุฐู ูุนุงูุฌ ุงูุฃุญุฏุงุซ ุจุดูู ุชุณูุณูู (sequentially).

**v7.1.0**

```dart
abstract class CounterEvent {}
class Increment extends CounterEvent {}

class CounterBloc extends Bloc<CounterEvent, int> {
  CounterBloc() : super(0);

  @override
  Stream<int> mapEventToState(CounterEvent event) async* {
    if (event is Increment) {
      yield state + 1;
    }
  }
}
```

**v7.2.0**

```dart
abstract class CounterEvent {}
class Increment extends CounterEvent {}

class CounterBloc extends Bloc<CounterEvent, int> {
  CounterBloc() : super(0) {
    on<Increment>((event, emit) => emit(state + 1));
  }
}
```

:::note

ูุนูู ูู `EventHandler` ุจุดูู ูุณุชููุ ูุฐูู ูู ุงูููู ุชุณุฌูู ูุนุงูุฌุงุช ุงูุฃุญุฏุงุซ ุจูุงุกู ุนูู
ููุน ุงูู transformer ุงูุฐู ุชุฑุบุจ ูู ุงุณุชุฎุฏุงูู.

:::

ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงูุญูุงุธ ุนูู ููุณ ุงูุณููู ุชูุงููุง ููุง ูู v7.1.0ุ ููููู ุชุณุฌูู ูุนุงูุฌ
ุฃุญุฏุงุซ ูุงุญุฏ ูุฌููุน ุงูุฃุญุฏุงุซ ูุชุทุจูู transformer ุชุณูุณูู (`sequential`).

```dart
import 'package:bloc/bloc.dart';
import 'package:bloc_concurrency/bloc_concurrency.dart';

class MyBloc extends Bloc<MyEvent, MyState> {
  MyBloc() : super(MyState()) {
    on<MyEvent>(_onEvent, transformer: sequential())
  }

  FutureOr<void> _onEvent(MyEvent event, Emitter<MyState> emit) async {
    // TODO: ุงูููุทู ุงูุจุฑูุฌู ููุถุน ููุง...
  }
}
```

ููููู ุฃูุถูุง ุชุฌุงูุฒ `EventTransformer` ุงูุงูุชุฑุงุถู ูุฌููุน ุงูู blocs ูู ุชุทุจููู:

```dart
import 'package:bloc/bloc.dart';
import 'package:bloc_concurrency/bloc_concurrency.dart';

void main() {
  Bloc.transformer = sequential<dynamic>();
  ...
}
```

#### โจ ุชูุฏูู `EventTransformer`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v7.2.0ุ ุชู ุฅููุงู ุงุณุชุฎุฏุงู `transformEvents` (deprecated)
ูุงุณุชุจุฏุงูู ุจู `EventTransformer`. ูุณูุชู ุฅุฒุงูุฉ `transformEvents` ูู ุงูุฅุตุฏุงุฑ
v8.0.0.

:::

##### ุงูุณุจุจ

ุฃุชุงุญ `on<Event>` ุฅููุงููุฉ ุชุฎุตูุต event transformer ููู ูุนุงูุฌ ุฃุญุฏุงุซ (event
handler).

ุชู ุชูุฏูู typedef ุฌุฏูุฏ ุจุงุณู `EventTransformer`ุ ูุงูุฐู ูุชูุญ ูููุทูุฑูู ุชุญููู ุชุฏูู
ุงูุฃุญุฏุงุซ ุงููุงุฑุฏุฉ ููู ูุนุงูุฌ ุจุดูู ูุณุชููุ ุจุฏูุงู ูู ุงุณุชุฎุฏุงู transformer ูุงุญุฏ ููุงูุฉ
ุงูุฃุญุฏุงุซ.

##### ููุฎุต

ูููู `EventTransformer` ุจุงุณุชูุจุงู ุชุฏูู ุงูุฃุญุฏุงุซ ุงููุงุฑุฏุฉ ูุน `EventMapper` (ูุนุงูุฌ
ุงูุฃุญุฏุงุซ)ุ ูุฅุฑุฌุงุน ุชุฏูู ุฌุฏูุฏ ูู ุงูุฃุญุฏุงุซ.

```dart
typedef EventTransformer<Event> = Stream<Event> Function(Stream<Event> events, EventMapper<Event> mapper)
```

ูููู ุงูู `EventTransformer` ุงูุงูุชุฑุงุถู ุจูุนุงูุฌุฉ ุฌููุน ุงูุฃุญุฏุงุซ ุจุดูู ูุชุฒุงูู ููุจุฏู
ูุงูุชุงูู:

```dart
EventTransformer<E> concurrent<E>() {
  return (events, mapper) => events.flatMap(mapper);
}
```

:::tip

ุชุญูู ูู [package:bloc_concurrency](https://pub.dev/packages/bloc_concurrency)
ููุญุตูู ุนูู ูุฌููุนุฉ ูุฎุชุงุฑุฉ ูู ูุญููุงุช ุงูุฃุญุฏุงุซ ุงููุฎุตุตุฉ.

:::

**v7.1.0**

```dart
@override
Stream<Transition<MyEvent, MyState>> transformEvents(events, transitionFn) {
  return events
    .debounceTime(const Duration(milliseconds: 300))
    .flatMap(transitionFn);
}
```

**v7.2.0**

```dart
/// ุชุนุฑูู EventTransformer ูุฎุตุต
EventTransformer<MyEvent> debounce<MyEvent>(Duration duration) {
  return (events, mapper) => events.debounceTime(duration).flatMap(mapper);
}

MyBloc() : super(MyState()) {
  /// ุชุทุจูู EventTransformer ุงููุฎุตุต ุนูู ูุนุงูุฌ ุงูุญุฏุซ
  on<MyEvent>(_onEvent, transformer: debounce(const Duration(milliseconds: 300)))
}
```

#### โ๏ธ ุฅููุงู ุงุณุชุฎุฏุงู `transformTransitions`

:::note[ูุง ุงูุฐู ุชุบูุฑุ]

ูู ุงูุฅุตุฏุงุฑ bloc v7.2.0ุ ุชู ุฅููุงู ุงุณุชุฎุฏุงู `transformTransitions` (deprecated)
ูุงุณุชุจุฏุงูู ุจุชุฎุตูุต `stream`.

ูุณูุชู ุฅุฒุงูุฉ `transformTransitions` ูู ุงูุฅุตุฏุงุฑ v8.0.0.

:::

##### ุงูุณุจุจ

ูุชูุญ getter ุงูุฎุงุต ุจู `stream` ูู `Bloc` ุชุฎุตูุต ุชุฏูู ุงูุญุงูุงุช (states) ุงูุฎุงุฑุฌุฉ
ุจุณูููุฉุ ูุฐูู ูู ุชุนุฏ ููุงู ุญุงุฌุฉ ููุงุญุชูุงุธ ุจูุงุฌูุฉ ูููุตูุฉ ูุซู `transformTransitions`.

##### ููุฎุต

**v7.1.0**

```dart
@override
Stream<Transition<Event, State>> transformTransitions(
  Stream<Transition<Event, State>> transitions,
) {
  return transitions.debounceTime(const Duration(milliseconds: 42));
}
```

**v7.2.0**

```dart
@override
Stream<State> get stream => super.stream.debounceTime(const Duration(milliseconds: 42));
```

## v7.0.0

### `package:bloc`

#### โ ุฃุตุจุญ ูู ูู `Bloc` ู `Cubit` ูุนุชูุฏุงู ุนูู `BlocBase`

##### ุงูุณุจุจ

ููุทูุฑุ ูุงูุช ุงูุนูุงูุฉ ุจูู blocs ู cubits ุบูุฑ ูุงุถุญุฉ ุฅูู ุญุฏู ูุง.

ุนูุฏ ุชูุฏูู Cubit ูุฃูู ูุฑุฉุ ูุงู ููุณุชุฎุฏู ููุฆุฉ ุฃุณุงุณูุฉ (base class) ูู blocsุ ููู ูุง
ูุงู ููุทูููุง ูุฃูู ูููุฑ ุฌุฒุกูุง ูู ุงููุธุงุฆูุ ุจูููุง ุชููู blocs ุจุชูุณูุนู ูุฅุถุงูุฉ ุงููุฒูุฏ
ูู ุงูู APIs.

ููู ูุฐุง ุงูุชุตููู ุฃุฏู ุฅูู ุจุนุถ ุงููุดุงูู:

- ูุงู ูู ุงูุถุฑูุฑู ุฅูุง ุฅุนุงุฏุฉ ุชุณููุฉ APIs ูุชุฏุนู cubit ุจุดูู ุฏูููุ ุฃู ุงูุฅุจูุงุก ุนูู
  ุชุณููุงุช bloc ููุญูุงุธ ุนูู ุงูุงุชุณุงูุ ุฑุบู ุฃู ุฐูู ุบูุฑ ุฏููู ูู ุงููุงุญูุฉ ุงููููููุฉ  
  ([#1708](https://github.com/felangel/bloc/issues/1708)ุ [#1560](https://github.com/felangel/bloc/issues/1560)).

- ูุงู ุนูู Cubit ุฃู ูุฑุซ ูู `Stream` ููุทุจู `EventSink` ูุชูููุฑ ูุงุนุฏุฉ ูุดุชุฑูุฉ ูููู ุฃู
  ุชุนุชูุฏ ุนูููุง ููููุงุช ูุซู `BlocBuilder` ู `BlocListener`  
  ([#1429](https://github.com/felangel/bloc/issues/1429)).

---

ูุงุญููุงุ ุชู ุชุฌุฑุจุฉ ุนูุณ ุงูุนูุงูุฉ ูุฌุนู bloc ูู ุงููุฆุฉ ุงูุฃุณุงุณูุฉ.

ูุฐุง ุงูุญู ุนุงูุฌ ุฌุฒุฆููุง ุงููุดููุฉ ุงูุฃูููุ ูููู ุชุณุจุจ ูู ูุดุงูู ุฃุฎุฑู:

- ุฃุตุจุญ API ุงูุฎุงุต ุจู cubit ูุนูุฏูุง ุจุณุจุจ ูุฑุงุซุฉ APIs ูู bloc ูุซู `mapEventToState` ู
  `add` ูุบูุฑูุง  
  ([#2228](https://github.com/felangel/bloc/issues/2228))

  - ููููู ูููุทูุฑูู ุงุณุชุฎุฏุงู ูุฐู APIs ุจุดูู ุบูุฑ ุตุญูุญ ููุง ูุคุฏู ุฅูู ูุดุงูู

- ุงุณุชูุฑุช ูุดููุฉ ูุดู cubit ููุงูู ูุงุฌูุฉ `Stream` ููุง ูุงูุช ุณุงุจููุง  
  ([#1429](https://github.com/felangel/bloc/issues/1429))

ูุญู ูุฐู ุงูุชุญุฏูุงุชุ ุชู ุชูุฏูู ูุฆุฉ ุฃุณุงุณูุฉ ุฌุฏูุฏุฉ ูุดุชุฑูุฉ ุจูู `Bloc` ู `Cubit` ุจุงุณู
`BlocBase`.

ูุณูุญ ุฐูู ููููููุงุช ุงูุฃุนูู ูู ุงูุชุทุจูู ุจุงูุชุนุงูู ูุน bloc ู cubit ุจุทุฑููุฉ ููุญุฏุฉุ ุฏูู
ุงูุญุงุฌุฉ ุฅูู ูุดู ูุงูู ูุงุฌูุงุช `Stream` ู `EventSink`.

##### ููุฎุต

**BlocObserver**

**v6.1.x**

```dart
class SimpleBlocObserver extends BlocObserver {
  @override
  void onCreate(Cubit cubit) {...}

  @override
  void onEvent(Bloc bloc, Object event) {...}

  @override
  void onChange(Cubit cubit, Object event) {...}

  @override
  void onTransition(Bloc bloc, Transition transition) {...}

  @override
  void onError(Cubit cubit, Object error, StackTrace stackTrace) {...}

  @override
  void onClose(Cubit cubit) {...}
}
```

**v7.0.0**

```dart
class SimpleBlocObserver extends BlocObserver {
  @override
  void onCreate(BlocBase bloc) {...}

  @override
  void onEvent(Bloc bloc, Object event) {...}

  @override
  void onChange(BlocBase bloc, Object? event) {...}

  @override
  void onTransition(Bloc bloc, Transition transition) {...}

  @override
  void onError(BlocBase bloc, Object error, StackTrace stackTrace) {...}

  @override
  void onClose(BlocBase bloc) {...}
}
```

**Bloc/Cubit**

**v6.1.x**

```dart
final bloc = MyBloc();
bloc.listen((state) {...});

final cubit = MyCubit();
cubit.listen((state) {...});
```

**v7.0.0**

```dart
final bloc = MyBloc();
bloc.stream.listen((state) {...});

final cubit = MyCubit();
cubit.stream.listen((state) {...});
```

### `package:bloc_test`

#### โ `seed` ุชูุนูุฏ ุฏุงูุฉ ูุฏุนู ุงูููู ุงูุฏููุงููููุฉ

##### ุงูุณุจุจ

ูุฏุนู ุงุณุชุฎุฏุงู ูููุฉ seed ูุงุจูุฉ ููุชุบููุฑ ููููู ุชุญุฏูุซูุง ุฏููุงูููููุง ุฏุงุฎู `setUp`ุ
ุฃุตุจุญุช `seed` ุชูุนูุฏ ุฏุงูุฉ ุจุฏูุงู ูู ูููุฉ ุซุงุจุชุฉ.

##### ููุฎุต

**v7.x.x**

```dart
blocTest(
  '...',
  seed: MyState(),
  ...
);
```

**v8.0.0**

```dart
blocTest(
  '...',
  seed: () => MyState(),
  ...
);
```

#### โ `expect` ุชูุนูุฏ ุฏุงูุฉ ูุฏุนู ุงูููู ุงูุฏููุงููููุฉ ูุน ุฏุนู `Matchers`

##### ุงูุณุจุจ

ูุฏุนู ุงุณุชุฎุฏุงู ุชููุน (expectation) ูุงุจู ููุชุบููุฑ ููููู ุชุญุฏูุซู ุฏููุงูููููุง ุฏุงุฎู
`setUp`ุ ุฃุตุจุญุช `expect` ุชูุนูุฏ ุฏุงูุฉ ุจุฏูุงู ูู ูููุฉ ุซุงุจุชุฉ.

ููุง ุชุฏุนู `expect` ุงุณุชุฎุฏุงู `Matchers`.

##### ููุฎุต

**v7.x.x**

```dart
blocTest(
  '...',
  expect: [MyStateA(), MyStateB()],
  ...
);
```

**v8.0.0**

```dart
blocTest(
  '...',
  expect: () => [MyStateA(), MyStateB()],
  ...
);

// ูููู ุฃู ูููู ุฃูุถุงู `Matcher`
blocTest(
  '...',
  expect: () => contains(MyStateA()),
  ...
);
```

#### โ `errors` ุชูุนูุฏ ุฏุงูุฉ ูุฏุนู ุงูููู ุงูุฏููุงููููุฉ ูุน ุฏุนู `Matchers`

##### ุงูุณุจุจ

ูุฏุนู ุงุณุชุฎุฏุงู ูุงุฆูุฉ ุฃุฎุทุงุก (errors) ูุงุจูุฉ ููุชุบููุฑ ููููู ุชุญุฏูุซูุง ุฏููุงูููููุง ุฏุงุฎู
`setUp`ุ ุฃุตุจุญุช `errors` ุชูุนูุฏ ุฏุงูุฉ ุจุฏูุงู ูู ูููุฉ ุซุงุจุชุฉ.

ููุง ุชุฏุนู `errors` ุงุณุชุฎุฏุงู `Matchers`.

##### ููุฎุต

**v7.x.x**

```dart
blocTest(
  '...',
  errors: [MyError()],
  ...
);
```

**v8.0.0**

```dart
blocTest(
  '...',
  errors: () => [MyError()],
  ...
);

// ูููู ุฃู ูููู ุฃูุถุงู `Matcher`
blocTest(
  '...',
  errors: () => contains(MyError()),
  ...
);
```

#### โ `MockBloc` ู `MockCubit`

##### ุงูุณุจุจ

ูุฏุนู ูุญุงูุงุฉ (stubbing) ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฃุณุงุณูุฉ ุจุดูู ุฃูุถูุ ุชู ุชูููุฑ
`MockBloc` ู `MockCubit` ุถูู ุญุฒูุฉ `bloc_test`.

ุณุงุจููุงุ ูุงู ูุชู ุงุณุชุฎุฏุงู `MockBloc` ููู ูู `Bloc` ู `Cubit`ุ ููู ูุง ูู ููู ูุงุถุญูุง
ุฃู ุจุฏููููุง ูููุทูุฑูู.

##### ููุฎุต

**v7.x.x**

```dart
class MockMyBloc extends MockBloc<MyState> implements MyBloc {}
class MockMyCubit extends MockBloc<MyState> implements MyBloc {}
```

**v8.0.0**

```dart
class MockMyBloc extends MockBloc<MyEvent, MyState> implements MyBloc {}
class MockMyCubit extends MockCubit<MyState> implements MyCubit {}
```

#### โ ุงูุชูุงูู ูุน `Mocktail`

##### ุงูุณุจุจ

ุจุณุจุจ ุงููููุฏ ุงููุฎุชููุฉ ูู ุงูุญุฒูุฉ ุงูุฏุงุนูุฉ ูู null-safety
[package:mockito](https://pub.dev/packages/mockito) ูุงููููุถุญุฉ
[ููุง](https://github.com/dart-lang/mockito/blob/master/NULL_SAFETY_README.md#problems-with-typical-mocking-and-stubbing)ุ
ุชู ุงุนุชูุงุฏ [package:mocktail](https://pub.dev/packages/mocktail) ูู `MockBloc` ู
`MockCubit`.

ูุชูุญ ุฐูู ูููุทูุฑูู ุงุณุชุฎุฏุงู ูุงุฌูุฉ ูุญุงูุงุฉ ูุฃูููุฉ ุฏูู ุงูุญุงุฌุฉ ุฅูู ูุชุงุจุฉ stubs ูุฏูููุง
ุฃู ุงูุงุนุชูุงุฏ ุนูู ุชูููุฏ ุงูููุฏ.

##### ููุฎุต

**v7.x.x**

```dart
import 'package:mockito/mockito.dart';

...

when(bloc.state).thenReturn(MyState());
verify(bloc.add(any)).called(1);
```

**v8.0.0**

```dart
import 'package:mocktail/mocktail.dart';

...

when(() => bloc.state).thenReturn(MyState());
verify(() => bloc.add(any())).called(1);
```

> ูุฑุฌู ุงูุฑุฌูุน ุฅูู [#347](https://github.com/dart-lang/mockito/issues/347)
> ุจุงูุฅุถุงูุฉ ุฅูู
> [ุชูุซูู mocktail](https://github.com/felangel/mocktail/tree/main/packages/mocktail)
> ููุฒูุฏ ูู ุงูุชูุงุตูู.

### `package:flutter_bloc`

#### โ ุฅุนุงุฏุฉ ุชุณููุฉ ุงููุนุงูู `cubit` ุฅูู `bloc`

##### ุงูุณุจุจ

ูุชูุฌุฉ ูุฅุนุงุฏุฉ ุงูููููุฉ ูู `package:bloc` ูุชูุฏูู `BlocBase` ุงูุฐู ูุชู ุชูุฑูุซู ูู ูุจู
ููู ูู `Bloc` ู `Cubit`ุ ุชู ุชุบููุฑ ุงุณู ุงููุนุงูู ูู `BlocBuilder` ู `BlocConsumer`
ู `BlocListener` ูู `cubit` ุฅูู `bloc`ุ ูุฃู ูุฐู ุงููุงุฌูุงุช ุชุนูู ุนูู ุงูููุน
`BlocBase`.

ููุง ุฃู ูุฐุง ุงูุชุบููุฑ ูุชูุงุดู ุจุดูู ุฃูุถู ูุน ุงุณู ุงูููุชุจุฉุ ููุณุงูู ูู ุชุญุณูู ูุถูุญ ููุงุจููุฉ
ูุฑุงุกุฉ ุงูููุฏ.

##### ููุฎุต

**v6.1.x**

```dart
BlocBuilder(
  cubit: myBloc,
  ...
)

BlocListener(
  cubit: myBloc,
  ...
)

BlocConsumer(
  cubit: myBloc,
  ...
)
```

**v7.0.0**

```dart
BlocBuilder(
  bloc: myBloc,
  ...
)

BlocListener(
  bloc: myBloc,
  ...
)

BlocConsumer(
  bloc: myBloc,
  ...
)
```

### `package:hydrated_bloc`

#### โ ุฃุตุจุญ `storageDirectory` ูุทููุจูุง ุนูุฏ ุงุณุชุฏุนุงุก `HydratedStorage.build`

##### ุงูุณุจุจ

ูุฌุนู `package:hydrated_bloc` ุญุฒูุฉ Dart ุตูุฑูุฉุ ุชู ุฅุฒุงูุฉ ุงูุงุนุชูุงุฏ ุนูู
[package:path_provider](https://pub.dev/packages/path_provider).

ูุจุงูุชุงููุ ุฃุตุจุญ ุชูุฑูุฑ ุงููุนุงูู `storageDirectory` ุนูุฏ ุงุณุชุฏุนุงุก
`HydratedStorage.build` ุฅูุฒุงูููุงุ ููู ูุนุฏ ูุชู ุชุนูููู ุชููุงุฆููุง ุฅูู
`getTemporaryDirectory`.

##### ููุฎุต

**v6.x.x**

```dart
HydratedBloc.storage = await HydratedStorage.build();
```

**v7.0.0**

```dart
import 'package:path_provider/path_provider.dart';

...

HydratedBloc.storage = await HydratedStorage.build(
  storageDirectory: await getTemporaryDirectory(),
);
```

## v6.1.0

### `package:flutter_bloc`

#### โ ุชู ูุถุน ุนูุงูุฉ "ููุฌูุฑ" ุนูู `context.bloc` ู `context.repository` ูุตุงูุญ `context.read` ู `context.watch`

##### ุงูุณุจุจ

ุชู ุชูุฏูู `context.read` ู `context.watch` ู `context.select` ูุชุชูุงูู ูุน ูุงุฌูุฉ
ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฎุงุตุฉ ุจู [provider](https://pub.dev/packages/provider)ุ ูุงูุชู
ูุฃูููุง ุงูุนุฏูุฏ ูู ุงููุทูุฑููุ ููุฐูู ููุนุงูุฌุฉ ุงููุดููุงุช ุงูุชู ุชู ุทุฑุญูุง ูู ูุจู ุงููุฌุชูุน.

ููุชุญุณูู ุฃูุงู ุงูููุฏ ูุงูุญูุงุธ ุนูู ุงูุงุชุณุงูุ ุชู ูุถุน ุนูุงูุฉ "ููุฌูุฑ" ุนูู `context.bloc`ุ
ุญูุซ ูููู ุงุณุชุจุฏุงูู ุจู `context.read` ุฃู `context.watch` ุงุนุชูุงุฏูุง ุนูู ูุง ุฅุฐุง ูุงู
ูุชู ุงุณุชุฎุฏุงูู ูุจุงุดุฑุฉ ุฏุงุฎู `build`.

##### `context.watch`

ูููุฑ `context.watch` ุจุฏููุงู ุนููููุง ูุทูุจ
[MultiBlocBuilder](https://github.com/felangel/bloc/issues/538)ุ ุญูุซ ูููู ูุฑุงูุจุฉ
ุนุฏุฉ blocs ุฏุงุฎู `Builder` ูุงุญุฏ ูู ุฃุฌู ุจูุงุก ูุงุฌูุฉ ุงููุณุชุฎุฏู ุจูุงุกู ุนูู ุญุงูุงุช ูุชุนุฏุฏุฉ.

```dart
Builder(
  builder: (context) {
    final stateA = context.watch<BlocA>().state;
    final stateB = context.watch<BlocB>().state;
    final stateC = context.watch<BlocC>().state;

    // ุฅุฑุฌุงุน Widget ูุนุชูุฏ ุนูู ุญุงูุฉ BlocA ู BlocB ู BlocC
  }
);
```

##### `context.select`

ูุชูุญ `context.select` ูููุทูุฑูู ุฅุนุงุฏุฉ ุจูุงุก (rebuild) ูุงุฌูุฉ ุงููุณุชุฎุฏู ุจูุงุกู ุนูู ุฌุฒุก
ูุญุฏุฏ ูู ุญุงูุฉ ุงูู blocุ ููุง ูููุฑ ุจุฏููุงู ุฃุจุณุท ูุงุณุชุฎุฏุงู
[buildWhen](https://github.com/felangel/bloc/issues/1521).

```dart
final name = context.select((UserBloc bloc) => bloc.state.user.name);
```

ุชุณูุญ ููุง ุงููุทุนุฉ ุงูุจุฑูุฌูุฉ ุฃุนูุงู ุจุงููุตูู ุฅูู ุงูู widget ูุฅุนุงุฏุฉ ุจูุงุฆู ููุท ุนูุฏูุง
ูุชุบูุฑ ุงุณู ุงููุณุชุฎุฏู ุงูุญุงูู.

##### `context.read`

ุนูู ุงูุฑุบู ูู ุฃู `context.read` ูุจุฏู ูุดุงุจููุง ูู `context.bloc`ุ ุฅูุง ุฃู ููุงู
ุงุฎุชูุงูุงุช ุฏูููุฉ ููููุง ูููุฉ. ููุงููุง ูุชูุญ ูู ุงููุตูู ุฅูู ุงูู bloc ุจุงุณุชุฎุฏุงู
`BuildContext` ุฏูู ุงูุชุณุจุจ ูู ุฅุนุงุฏุฉ ุจูุงุก (rebuild)ุ ููุน ุฐููุ ูุง ูููู ุงุณุชุฎุฏุงู
`context.read` ูุจุงุดุฑุฉ ุฏุงุฎู ุฏุงูุฉ `build`.

ูุงู ููุงู ุณุจุจุงู ุฑุฆูุณูุงู ูุงุณุชุฎุฏุงู `context.bloc` ุฏุงุฎู `build`:

1. **ูููุตูู ุฅูู ุญุงูุฉ ุงูู bloc**

```dart
@override
Widget build(BuildContext context) {
  final state = context.bloc<MyBloc>().state;
  return Text('$state');
}
```

ููุนุฏ ุงูุงุณุชุฎุฏุงู ุฃุนูุงู ุนุฑุถุฉ ููุฃุฎุทุงุกุ ูุฃู ุนูุตุฑ `Text` ูู ุชุชู ุฅุนุงุฏุฉ ุจูุงุฆู ุนูุฏ ุชุบููุฑ
ุญุงูุฉ ุงูู bloc. ูู ูุฐู ุงูุญุงูุฉุ ูููุตุญ ุจุงุณุชุฎุฏุงู `BlocBuilder` ุฃู `context.watch`.
``

```dart
@override
Widget build(BuildContext context) {
  final state = context.watch<MyBloc>().state;
  return Text('$state');
}
```

ุฃู

```dart
@override
Widget build(BuildContext context) {
  return BlocBuilder<MyBloc, MyState>(
    builder: (context, state) => Text('$state'),
  );
}
```

:::note

ุณูุคุฏู ุงุณุชุฎุฏุงู `context.watch` ูู ุฌุฐุฑ ุฏุงูุฉ `build` ุฅูู ุฅุนุงุฏุฉ ุจูุงุก ุงูู widget
ุจุงููุงูู ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูู bloc. ุฅุฐุง ูู ุชูู ููุงู ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุจูุงุก ุงูู widget
ุจุงููุงููุ ููููู ุงุณุชุฎุฏุงู `BlocBuilder` ูุชุบููู ุงูุฃุฌุฒุงุก ุงูุชู ุชุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ุจูุงุกุ
ุฃู ุงุณุชุฎุฏุงู `Builder` ูุน `context.watch` ูุชุญุฏูุฏ ูุทุงู ุฅุนุงุฏุฉ ุงูุจูุงุกุ ุฃู ุชูุณูู ุงูู
widget ุฅูู ููููุงุช ุฃุตุบุฑ.

:::

2. **ูููุตูู ุฅูู ุงูู bloc ูู ุฃุฌู ุฅุถุงูุฉ ุญุฏุซ**

```dart
@override
Widget build(BuildContext context) {
  final bloc = context.bloc<MyBloc>();
  return ElevatedButton(
    onPressed: () => bloc.add(MyEvent()),
    ...
  )
}
```

ุงูุงุณุชุฎุฏุงู ุฃุนูุงู ุบูุฑ ูุนุงู ูุฃูู ูุคุฏู ุฅูู ุงูุจุญุซ ุนู ุงูู bloc ูู ูู ุนูููุฉ ุฅุนุงุฏุฉ ุจูุงุก
ุจูููุง ูุง ุชููู ููุงู ุญุงุฌุฉ ููู bloc ุฅูุง ุนูุฏูุง ูููุฑ ุงููุณุชุฎุฏู ุนูู ุงูู
`ElevatedButton`. ูู ูุฐุง ุงูุณููุงุฑููุ ููุถู ุงุณุชุฎุฏุงู `context.read` ูููุตูู ุฅูู ุงูู
bloc ูุจุงุดุฑุฉ ุญูุซ ุชุจุฑุฒ ุงูุญุงุฌุฉ ุฅููู (ูู ูุฐู ุงูุญุงูุฉุ ูู ุงุณุชุฏุนุงุก `onPressed`).

```dart
@override
Widget build(BuildContext context) {
  return ElevatedButton(
    onPressed: () => context.read<MyBloc>().add(MyEvent()),
    ...
  )
}
```

##### ููุฎุต

**v6.0.x**

```dart
@override
Widget build(BuildContext context) {
  final bloc = context.bloc<MyBloc>();
  return ElevatedButton(
    onPressed: () => bloc.add(MyEvent()),
    ...
  )
}
```

**v6.1.x**

```dart
@override
Widget build(BuildContext context) {
  return ElevatedButton(
    onPressed: () => context.read<MyBloc>().add(MyEvent()),
    ...
  )
}
```

?> ุฅุฐุง ููุช ุจุญุงุฌุฉ ูููุตูู ุฅูู bloc ูุฅุถุงูุฉ ุญุฏุซุ ูุงุณุชุฎุฏู `context.read` ุฏุงุฎู ุงูู
callback ูู ุงูููุงู ุงูุฐู ุชุญุชุงุฌู ููู.

**v6.0.x**

```dart
@override
Widget build(BuildContext context) {
  final state = context.bloc<MyBloc>().state;
  return Text('$state');
}
```

**v6.1.x**

```dart
@override
Widget build(BuildContext context) {
  final state = context.watch<MyBloc>().state;
  return Text('$state');
}
```

?> ุงุณุชุฎุฏู `context.watch` ุนูุฏ ุงููุตูู ุฅูู ุญุงูุฉ ุงูู bloc ูุถูุงู ุฅุนุงุฏุฉ ุจูุงุก ุงูู
widget ุนูุฏ ุชุบููุฑ ุงูุญุงูุฉ.

## v6.0.0

### `package:bloc`

#### โ ุฃุตุจุญ `BlocObserver.onError` ูุณุชูุจู `Cubit`

##### ุงูุณุจุจ

ุจุณุจุจ ุฏูุฌ `Cubit`ุ ุฃุตุจุญุช `onError` ูุดุชุฑูุฉ ุจูู ููู ูู `Bloc` ู `Cubit`. ูุจูุง ุฃู
`Cubit` ูู ุงููุฆุฉ ุงูุฃุณุงุณูุฉุ ูุฅู `BlocObserver` ูุณุชูุจู ููุน `Cubit` ุจุฏูุงู ูู `Bloc`
ุนูุฏ ุชุฌุงูุฒ `onError`.

**v5.x.x**

```dart
class MyBlocObserver extends BlocObserver {
  @override
  void onError(Bloc bloc, Object error, StackTrace stackTrace) {
    super.onError(bloc, error, stackTrace);
  }
}
```

**v6.0.0**

```dart
class MyBlocObserver extends BlocObserver {
  @override
  void onError(Cubit cubit, Object error, StackTrace stackTrace) {
    super.onError(cubit, error, stackTrace);
  }
}
```

#### โ ูุง ูููู `Bloc` ุจุฅุตุฏุงุฑ ุงูุญุงูุฉ ุงูุฃุฎูุฑุฉ ุนูุฏ ุงูุงุดุชุฑุงู

##### ุงูุณุจุจ

ุชู ุฅุฌุฑุงุก ูุฐุง ุงูุชุบููุฑ ูููุงุกูุฉ ุณููู `Bloc` ู `Cubit` ูุน ุณููู `Stream` ุงููุฏูุฌ ูู
Dart.

ุจุงูุฅุถุงูุฉ ุฅูู ุฐููุ ุฃุฏู ุงูุงูุชุฒุงู ุจุงูุณููู ุงูุณุงุจู ูู `Cubit` ุฅูู ุธููุฑ ุงูุนุฏูุฏ ูู
ุงูุขุซุงุฑ ุงูุฌุงูุจูุฉ ุบูุฑ ุงูููุตูุฏุฉุ ููุง ุฒุงุฏ ูู ุชุนููุฏ ุงูุชูููุฐ ุงูุฏุงุฎูู ูุญุฒู ุฃุฎุฑู ูุซู
`flutter_bloc` ู `bloc_test` ุฏูู ุฏุงุนู (ูุซู ุงูุญุงุฌุฉ ุฅูู ุงุณุชุฎุฏุงู `skip(1)` ูุบูุฑูุง).

**v5.x.x**

```dart
final bloc = MyBloc();
bloc.listen(print);
```

ุณุงุจููุงุ ูุงู ุงูููุฏ ุฃุนูุงู ูููู ุจุฅุฎุฑุงุฌ (output) ุงูุญุงูุฉ ุงูุฃูููุฉ ููู blocุ ุชูููุง
ุชุบููุฑุงุช ุงูุญุงูุฉ ุงููุงุญูุฉ.

**v6.x.x**

ูู ุงูุฅุตุฏุงุฑ v6.0.0ุ ูู ูุนุฏ ุงูููุฏ ุฃุนูุงู ูุฎุฑุฌ ุงูุญุงูุฉ ุงูุฃูููุฉุ ูุฅููุง ููุชุตุฑ ุนูู ุฅุฎุฑุงุฌ
ุชุบููุฑุงุช ุงูุญุงูุฉ ุงููุงุญูุฉ ููุท. ูููู ุงุณุชุนุงุฏุฉ ุงูุณููู ุงูุณุงุจู ุจุงุณุชุฎุฏุงู ูุง ููู:

```dart
final bloc = MyBloc();
print(bloc.state);
bloc.listen(print);
```

?> **ููุงุญุธุฉ**: ูุคุซุฑ ูุฐุง ุงูุชุบููุฑ ููุท ุนูู ุงูููุฏ ุงูุฐู ูุนุชูุฏ ุนูู ุงูุงุดุชุฑุงู ุงููุจุงุดุฑ ูู
ุงูู bloc. ุนูุฏ ุงุณุชุฎุฏุงู `BlocBuilder` ุฃู `BlocListener` ุฃู `BlocConsumer`ุ ูู ูููู
ููุงู ุฃู ุชุบููุฑ ููุญูุธ ูู ุงูุณููู.

### `package:bloc_test`

#### โ `MockBloc` ูุชุทูุจ ููุน ุงูุญุงูุฉ (`State`) ููุท

##### ุงูุณุจุจ

ูู ูุนุฏ ูู ุงูุถุฑูุฑู ุชุญุฏูุฏ ุฃููุงุน ุฅุถุงููุฉุ ููุง ูููู ูู ุงูููุฏ ุงูุฒุงุฆุฏุ ููุง ูุฌุนู
`MockBloc` ูุชูุงูููุง ูุน `Cubit`.

**v5.x.x**

```dart
class MockCounterBloc extends MockBloc<CounterEvent, int> implements CounterBloc {}
```

**v6.0.0**

```dart
class MockCounterBloc extends MockBloc<int> implements CounterBloc {}
```

#### โ `whenListen` ูุชุทูุจ ููุน ุงูุญุงูุฉ (`State`) ููุท

##### ุงูุณุจุจ

ูู ูุนุฏ ูู ุงูุถุฑูุฑู ุชุญุฏูุฏ ุฃููุงุน ุฅุถุงููุฉุ ููุง ูููู ูู ุงูููุฏ ุงูุฒุงุฆุฏุ ููุง ูุฌุนู
`whenListen` ูุชูุงูููุง ูุน `Cubit`.

**v5.x.x**

```dart
whenListen<CounterEvent,int>(bloc, Stream.fromIterable([0, 1, 2, 3]));
```

**v6.0.0**

```dart
whenListen<int>(bloc, Stream.fromIterable([0, 1, 2, 3]));
```

#### โ `blocTest` ูุง ูุชุทูุจ ููุน ุงูุญุฏุซ (`Event`)

##### ุงูุณุจุจ

ูู ูุนุฏ ูู ุงูุถุฑูุฑู ุชุญุฏูุฏ ููุน ุงูุญุฏุซุ ููุง ูููู ูู ุงูููุฏ ุงูุฒุงุฆุฏุ ููุง ูุฌุนู `blocTest`
ูุชูุงูููุง ูุน `Cubit`.

**v5.x.x**

```dart
blocTest<CounterBloc, CounterEvent, int>(
  'emits [1] when increment is called',
  build: () async => CounterBloc(),
  act: (bloc) => bloc.add(CounterEvent.increment),
  expect: const <int>[1],
);
```

**v6.0.0**

```dart
blocTest<CounterBloc, int>(
  'emits [1] when increment is called',
  build: () => CounterBloc(),
  act: (bloc) => bloc.add(CounterEvent.increment),
  expect: const <int>[1],
);
```

#### โ ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู `skip` ูู `blocTest` ุฃุตุจุญุช 0

##### ุงูุณุจุจ

ุจูุง ุฃู ูุซููุงุช `bloc` ู `cubit` ูู ุชุนุฏ ุชูุตุฏุฑ ุงูุญุงูุฉ ุงูุฃุฎูุฑุฉ ุนูุฏ ุงูุงุดุชุฑุงู ุงูุฌุฏูุฏุ
ูู ูุนุฏ ูู ุงูุถุฑูุฑู ุชุนููู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู `skip` ุฅูู `1`.

**v5.x.x**

```dart
blocTest<CounterBloc, CounterEvent, int>(
  'emits [0] when skip is 0',
  build: () async => CounterBloc(),
  skip: 0,
  expect: const <int>[0],
);
```

**v6.0.0**

```dart
blocTest<CounterBloc, int>(
  'emits [] when skip is 0',
  build: () => CounterBloc(),
  skip: 0,
  expect: const <int>[],
);
```

ูููู ุงุฎุชุจุงุฑ ุงูุญุงูุฉ ุงูุฃูููุฉ ูู bloc ุฃู cubit ุจูุง ููู:

```dart
test('initial state is correct', () {
  expect(MyBloc().state, InitialState());
});
```

#### โ ุฌุนู `build` ูู `blocTest` ูุชุฒุงูููุง (synchronous)

##### ุงูุณุจุจ

ุณุงุจููุงุ ูุงู ูุชู ุฌุนู `build` ุบูุฑ ูุชุฒุงูู (`async`) ูุฅุชุงุญุฉ ุชูููุฐ ุจุนุถ ุงูุชุญุถูุฑุงุช ูู
ุฃุฌู ูุถุน ุงูู bloc ุชุญุช ุงูุงุฎุชุจุงุฑ ูู ุญุงูุฉ ูุญุฏุฏุฉ. ูู ูุนุฏ ุฐูู ุถุฑูุฑููุงุ ููุง ุฃูู ูุณุงูู
ูู ุญู ุนุฏุฉ ูุดููุงุช ูุงุชุฌุฉ ุนู ุงูุชุฃุฎูุฑ ุจูู ูุฑุญูุฉ ุงูุจูุงุก (build) ูุจุฏุก ุงูุงุดุชุฑุงู
ุฏุงุฎูููุง.

ุจุฏููุง ูู ุงูุงุนุชูุงุฏ ุนูู ุงูุชุญุถูุฑ ุบูุฑ ุงููุชุฒุงูู ูููุตูู ุฅูู ุญุงูุฉ ูุนููุฉุ ูููู ุงูุขู
ุชุนููู ุญุงูุฉ ุงูู bloc ูุจุงุดุฑุฉ ุจุงุณุชุฎุฏุงู `emit` ูุน ุงูุญุงูุฉ ุงููุทููุจุฉ.

**v5.x.x**

```dart
blocTest<CounterBloc, CounterEvent, int>(
  'emits [2] when increment is added',
  build: () async {
    final bloc = CounterBloc();
    bloc.add(CounterEvent.increment);
    await bloc.take(2);
    return bloc;
  }
  act: (bloc) => bloc.add(CounterEvent.increment),
  expect: const <int>[2],
);
```

**v6.0.0**

```dart
blocTest<CounterBloc, int>(
  'emits [2] when increment is added',
  build: () => CounterBloc()..emit(1),
  act: (bloc) => bloc.add(CounterEvent.increment),
  expect: const <int>[2],
);
```

:::note

ุชูุณุชุฎุฏู `emit` ูุฃุบุฑุงุถ ุงูุงุฎุชุจุงุฑ ููุทุ ููุง ููุจุบู ุงุณุชุฎุฏุงููุง ุฎุงุฑุฌ ูุทุงู ุงูุงุฎุชุจุงุฑุงุช.

:::

### `package:flutter_bloc`

#### โ ุฅุนุงุฏุฉ ุชุณููุฉ ุงููุนุงูู `bloc` ูู `BlocBuilder` ุฅูู `cubit`

##### ุงูุณุจุจ

ูุฌุนู `BlocBuilder` ูุนูู ูุน ููู ูู ูุซููุงุช `bloc` ู `cubit`ุ ุชู ุชุบููุฑ ุงุณู ุงููุนุงูู
ูู `bloc` ุฅูู `cubit` (ูุธุฑูุง ูุฃู `Cubit` ูู ุงููุฆุฉ ุงูุฃุณุงุณูุฉ).

**v5.x.x**

```dart
BlocBuilder(
  bloc: myBloc,
  builder: (context, state) {...}
)
```

**v6.0.0**

```dart
BlocBuilder(
  cubit: myBloc,
  builder: (context, state) {...}
)
```

#### โ ุฅุนุงุฏุฉ ุชุณููุฉ ุงููุนุงูู `bloc` ูู `BlocListener` ุฅูู `cubit`

##### ุงูุณุจุจ

ูุฌุนู `BlocListener` ูุนูู ูุน ููู ูู ูุซููุงุช `bloc` ู `cubit`ุ ุชู ุชุบููุฑ ุงุณู ุงููุนุงูู
ูู `bloc` ุฅูู `cubit` (ูุธุฑูุง ูุฃู `Cubit` ูู ุงููุฆุฉ ุงูุฃุณุงุณูุฉ).

**v5.x.x**

```dart
BlocListener(
  bloc: myBloc,
  listener: (context, state) {...}
)
```

**v6.0.0**

```dart
BlocListener(
  cubit: myBloc,
  listener: (context, state) {...}
)
```

#### โ ุฅุนุงุฏุฉ ุชุณููุฉ ุงููุนุงูู `bloc` ูู `BlocConsumer` ุฅูู `cubit`

##### ุงูุณุจุจ

ูุฌุนู `BlocConsumer` ูุนูู ูุน ููู ูู ูุซููุงุช `bloc` ู `cubit`ุ ุชู ุชุบููุฑ ุงุณู ุงููุนุงูู
ูู `bloc` ุฅูู `cubit` (ูุธุฑูุง ูุฃู `Cubit` ูู ุงููุฆุฉ ุงูุฃุณุงุณูุฉ).

**v5.x.x**

```
BlocConsumer(
  cubit: myBloc,
  listener: (context, state) {...},
  builder: (context, state) {...}
)
```

**v6.0.0**

```dart
BlocConsumer(
  cubit: myBloc,
  listener: (context, state) {...},
  builder: (context, state) {...}
)
```

---

## v5.0.0

### `package:bloc`

#### โ ุชูุช ุฅุฒุงูุฉ `initialState`

##### ุงูุณุจุจ

ููุทูุฑุ ูุงู ุงูุงุถุทุฑุงุฑ ุฅูู ุชุฌุงูุฒ `initialState` ุนูุฏ ุฅูุดุงุก bloc ูุณุจุจ ูุดููุชูู
ุฑุฆูุณูุชูู:

- ูููู ุฃู ุชููู `initialState` ุฏููุงููููุฉุ ููุง ูููู ุงููุตูู ุฅูููุง ูุงุญููุง (ุญุชู ูู
  ุฎุงุฑุฌ ุงูู bloc ููุณู)ุ ููุง ูุฏ ููุนุฏ ุชุณุฑูุจูุง ูุจุนุถ ุชูุงุตููู ุงูุฏุงุฎููุฉ ุฅูู ุทุจูุฉ ูุงุฌูุฉ
  ุงููุณุชุฎุฏู.
- ูุชุทูุจ ุฐูู ูุชุงุจุฉ ููุฏ ุฅุถุงูู ูุบูุฑ ุถุฑูุฑู (verbose).

**v4.x.x**

```dart
class CounterBloc extends Bloc<CounterEvent, int> {
  @override
  int get initialState => 0;

  ...
}
```

**v5.0.0**

```dart
class CounterBloc extends Bloc<CounterEvent, int> {
  CounterBloc() : super(0);

  ...
}
```

?> ููุฒูุฏ ูู ุงููุนูููุงุชุ ุฑุงุฌุน
[#1304](https://github.com/felangel/bloc/issues/1304)

#### โ ุฅุนุงุฏุฉ ุชุณููุฉ `BlocDelegate` ุฅูู `BlocObserver`

##### ุงูุณุจุจ

ูู ููู ุงุณู `BlocDelegate` ูุนูุณ ุจุฏูุฉ ุงูุฏูุฑ ุงูุญูููู ููุฐู ุงููุฆุฉ. ุฅุฐ ููุญู ุงูุงุณู ุจุฃู
ููุง ุฏูุฑูุง ูุดุทูุงุ ุจูููุง ูู ุงููุงูุน ูุงู ุงููุฏู ูููุง ุฃู ุชููู ูููููุง ุณูุจููุง ูููู ููุท
ุจูุฑุงูุจุฉ ุฌููุน ุงูู blocs ุฏุงุฎู ุงูุชุทุจูู.

:::note

ูู ุงูููุชุฑุถ ุฃูุง ูุญุชูู `BlocObserver` ุนูู ุฃู ููุทู ุฃู ูุธุงุฆู ููุฌูุฉ ูููุณุชุฎุฏูุ ุจู
ููุชุตุฑ ุฏูุฑู ุนูู ุงููุฑุงูุจุฉ ููุท.

:::

**v4.x.x**

```dart
class MyBlocDelegate extends BlocDelegate {
  ...
}
```

**v5.0.0**

```dart
class MyBlocObserver extends BlocObserver {
  ...
}
```

#### โ ุชูุช ุฅุฒุงูุฉ `BlocSupervisor`

##### ุงูุณุจุจ

ูุงู `BlocSupervisor` ูููููุง ุฅุถุงูููุง ูุชุนูู ุนูู ุงููุทูุฑูู ุงูุชุนุฑู ุนููู ูุงูุชุนุงูู ูุนู
ููุท ูู ุฃุฌู ุชุนููู `BlocDelegate` ูุฎุตุต. ูุน ุงูุงูุชูุงู ุฅูู `BlocObserver`ุ ุฃุตุจุญ ูู
ุงูุฃุจุณุท ูุงูุฃูุถู ูู ูุงุญูุฉ ุชุฌุฑุจุฉ ุงููุทูุฑ ุชุนููู ุงููุฑุงูุจ ูุจุงุดุฑุฉ ุนูู ุงูู bloc ููุณู.

?> ููุง ุฃุชุงุญ ูุฐุง ุงูุชุบููุฑ ูุตู ุจุนุถ ุฅุถุงูุงุช bloc ุงูุฃุฎุฑู ูุซู `HydratedStorage` ุนู
`BlocObserver`.

**v4.x.x**

```dart
BlocSupervisor.delegate = MyBlocDelegate();
```

**v5.0.0**

```dart
Bloc.observer = MyBlocObserver();
```

### `package:flutter_bloc`

#### โ ุฅุนุงุฏุฉ ุชุณููุฉ `condition` ูู `BlocBuilder` ุฅูู `buildWhen`

##### ุงูุณุจุจ

ุนูุฏ ุงุณุชุฎุฏุงู `BlocBuilder`ุ ูุงู ุจุงูุฅููุงู ุณุงุจููุง ุชุญุฏูุฏ `condition` ููุชุญูู ูู ูุง
ุฅุฐุง ูุงู ูุฌุจ ุนูู `builder` ุฅุนุงุฏุฉ ุงูุจูุงุก ุฃู ูุง.

```dart
BlocBuilder<MyBloc, MyState>(
  condition: (previous, current) {
    // ุฅุฑุฌุงุน true/false ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุงุณุชุฏุนุงุก ุงูู builder
  },
  builder: (context, state) {...}
)
```

ูู ููู ุงูุงุณู `condition` ูุงุถุญูุง ุฃู ูุนุจูุฑูุง ุจุดูู ูุงููุ ูุงูุฃูู ูู ุฐูู ุฃูู ุฃุฏู ุฅูู
ุนุฏู ุงุชุณุงู ูู ูุงุฌูุฉ ุงูุงุณุชุฎุฏุงู (API) ุนูุฏ ุงูุชุนุงูู ูุน `BlocConsumer`ุ ุญูุซ ูููู
ูููุทูุฑูู ุชุญุฏูุฏ ุดุฑุทูู ูุฎุชูููู (ุฃุญุฏููุง ูู `builder` ูุงูุขุฎุฑ ูู `listener`).

ููุชูุฌุฉ ูุฐููุ ุฃุตุจุญุช ูุงุฌูุฉ `BlocConsumer` ุชููุฑ `buildWhen` ู `listenWhen`.

```dart
BlocConsumer<MyBloc, MyState>(
  listenWhen: (previous, current) {
    // ุฅุฑุฌุงุน true/false ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุงุณุชุฏุนุงุก ุงูู listener
  },
  listener: (context, state) {...},
  buildWhen: (previous, current) {
    // ุฅุฑุฌุงุน true/false ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุงุณุชุฏุนุงุก ุงูู builder
  },
  builder: (context, state) {...},
)
```

ูุชุญููู ุงุชุณุงู ุฃูุจุฑ ูู ูุงุฌูุฉ ุงูุงุณุชุฎุฏุงู (API) ูุชูููุฑ ุชุฌุฑุจุฉ ุชุทููุฑ ุฃูุซุฑ ุณูุงุณุฉุ ุชูุช
ุฅุนุงุฏุฉ ุชุณููุฉ `condition` ุฅูู `buildWhen`.

**v4.x.x**

```dart
BlocBuilder<MyBloc, MyState>(
  condition: (previous, current) {
    // ุฅุฑุฌุงุน true/false ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุงุณุชุฏุนุงุก ุงูู builder
  },
  builder: (context, state) {...}
)
```

**v5.0.0**

```dart
BlocBuilder<MyBloc, MyState>(
  buildWhen: (previous, current) {
    // ุฅุฑุฌุงุน true/false ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุงุณุชุฏุนุงุก ุงูู builder
  },
  builder: (context, state) {...}
)
```

#### โ ุฅุนุงุฏุฉ ุชุณููุฉ `condition` ูู `BlocListener` ุฅูู `listenWhen`

##### ุงูุณุจุจ

ูููุณ ุงูุฃุณุจุงุจ ุงููุฐููุฑุฉ ุฃุนูุงูุ ุชู ุฃูุถูุง ุฅุนุงุฏุฉ ุชุณููุฉ `condition` ูู `BlocListener`
ุฅูู `listenWhen`.

**v4.x.x**

```dart
BlocListener<MyBloc, MyState>(
  condition: (previous, current) {
    // ุฅุฑุฌุงุน true/false ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุงุณุชุฏุนุงุก ุงูู listener
  },
  listener: (context, state) {...}
)
```

**v5.0.0**

```dart
BlocListener<MyBloc, MyState>(
  listenWhen: (previous, current) {
    // ุฅุฑุฌุงุน true/false ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุงุณุชุฏุนุงุก ุงูู listener
  },
  listener: (context, state) {...}
)
```

### `package:hydrated_bloc`

#### โ ุฅุนุงุฏุฉ ุชุณููุฉ `HydratedStorage` ู `HydratedBlocStorage`

##### ุงูุณุจุจ

ูุชุญุณูู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูููุฏ ุจูู
[hydrated_bloc](https://pub.dev/packages/hydrated_bloc) ู
[hydrated_cubit](https://pub.dev/packages/hydrated_cubit)ุ ุชู ุชุบููุฑ ุงุณู ุชูููุฐ
ุงูุชุฎุฒูู ุงูุงูุชุฑุงุถู ูู `HydratedBlocStorage` ุฅูู `HydratedStorage`.

ุจุงูุฅุถุงูุฉ ุฅูู ุฐููุ ุชูุช ุฅุนุงุฏุฉ ุชุณููุฉ ูุงุฌูุฉ `HydratedStorage` ุฅูู `Storage`.

**v4.0.0**

```dart
class MyHydratedStorage implements HydratedStorage {
  ...
}
```

**v5.0.0**

```dart
class MyHydratedStorage implements Storage {
  ...
}
```

#### โ ูุตู `HydratedStorage` ุนู `BlocDelegate`

##### ุงูุณุจุจ

ููุง ุฐููุฑ ุณุงุจููุงุ ุชูุช ุฅุนุงุฏุฉ ุชุณููุฉ `BlocDelegate` ุฅูู `BlocObserver`ุ ูุฃุตุจุญ ูุชู
ุชุนูููู ูุจุงุดุฑุฉ ุถูู ุฅุนุฏุงุฏุงุช ุงูู bloc ููุง ููู:

```dart
Bloc.observer = MyBlocObserver();
```

ุชู ุฅุฌุฑุงุก ูุฐุง ุงูุชุบููุฑ ูู ุฃุฌู:

- ุงูุญูุงุธ ุนูู ุงูุงุชุณุงู ูุน ูุงุฌูุฉ `BlocObserver` ุงูุฌุฏูุฏุฉ
- ุฅุจูุงุก ุงูุชุฎุฒูู (`Storage`) ูุญุตูุฑูุง ุถูู `HydratedBloc` ููุท
- ูุตู `BlocObserver` ุนู `Storage`

**v4.0.0**

```dart
BlocSupervisor.delegate = await HydratedBlocDelegate.build();
```

**v5.0.0**

```dart
HydratedBloc.storage = await HydratedStorage.build();
```

#### โ ุชุจุณูุท ุนูููุฉ ุงูุชููุฆุฉ (Initialization)

##### ุงูุณุจุจ

ุณุงุจููุงุ ูุงู ุนูู ุงููุทูุฑูู ุงุณุชุฏุนุงุก `super.initialState ?? DefaultInitialState()`
ูุฏูููุง ูู ุฃุฌู ุชููุฆุฉ ูุซููุงุช `HydratedBloc`. ูุงู ูุฐุง ุงูุฃุณููุจ ูุนูุฏูุง ููุทูููุงุ ููุง
ุฃูู ุบูุฑ ูุชูุงูู ูุน ุงูุชุบููุฑุงุช ุงูุฌููุฑูุฉ ุนูู `initialState` ูู `bloc`.

ููุชูุฌุฉ ูุฐููุ ุฃุตุจุญุช ุชููุฆุฉ `HydratedBloc` ูู ุงูุฅุตุฏุงุฑ v5.0.0 ููุงุซูุฉ ุชูุงููุง ูุชููุฆุฉ
`Bloc` ุงูุนุงุฏูุฉ.

**v4.0.0**

```dart
class CounterBloc extends HydratedBloc<CounterEvent, int> {
  @override
  int get initialState => super.initialState ?? 0;
}
```

**v5.0.0**

```dart
class CounterBloc extends HydratedBloc<CounterEvent, int> {
  CounterBloc() : super(0);

  ...
}
```
