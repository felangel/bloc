---
title: نمذجة الحالة (Modeling State)
description:
  نظرة عامة على عدة طرق لنمذجة الحالات عند استخدام حزمة bloc.
---

import ConcreteClassAndStatusEnumSnippet from '~/components/modeling-state/ConcreteClassAndStatusEnumSnippet.astro';
import SealedClassAndSubclassesSnippet from '~/components/modeling-state/SealedClassAndSubclassesSnippet.astro';

هناك العديد من الأساليب المختلفة عندما يتعلق الأمر بهيكلة حالة التطبيق. لكل منها مزاياه وعيوبه. في هذا القسم، سنلقي نظرة على عدة أساليب، إيجابياتها وسلبياتها، ومتى يجب استخدام كل منها.

الأساليب التالية هي مجرد توصيات وهي اختيارية بالكامل. لا تتردد في استخدام أي أسلوب تفضله. قد تجد أن بعض الأمثلة/التوثيقات لا تتبع هذه الأساليب بشكل أساسي من أجل التبسيط/الإيجاز.

:::tip

تركز مقتطفات الكود التالية على هيكل الحالة. من الناحية العملية، قد ترغب أيضًا في:

-   توسيع `Equatable` من حزمة
    [`package:equatable`](https://pub.dev/packages/equatable)
-   تعيين التعليق التوضيحي `@Data()` للفئة من حزمة
    [`package:data_class`](https://pub.dev/packages/data_class)
-   تعيين التعليق التوضيحي **@immutable** للفئة من حزمة
    [`package:meta`](https://pub.dev/packages/meta)
-   تنفيذ دالة `copyWith`
-   استخدام الكلمة المفتاحية `const` للمُنشئات (constructors)

:::

## الفئة الملموسة وتعداد الحالة (Concrete Class and Status Enum)

يتكون هذا الأسلوب من **فئة ملموسة واحدة** لجميع الحالات جنبًا إلى جنب مع `enum` يمثل حالات مختلفة. يتم جعل الخصائص قابلة للقيمة الفارغة (nullable) ويتم التعامل معها بناءً على الحالة الحالية. يعمل هذا الأسلوب بشكل أفضل للحالات التي ليست حصرية بشكل صارم و/أو تحتوي على الكثير من الخصائص المشتركة.

<ConcreteClassAndStatusEnumSnippet />

#### الإيجابيات (Pros)

-   **بسيط (Simple)**: سهل إدارة فئة واحدة وتعداد حالة (status enum) وجميع الخصائص يمكن الوصول إليها بسهولة.
-   **موجز (Concise)**: يتطلب عمومًا عددًا أقل من أسطر الكود مقارنة بالأساليب الأخرى.

#### السلبيات (Cons)

-   **غير آمن من حيث النوع (Not Type Safe)**: يتطلب التحقق من `status` قبل الوصول إلى الخصائص. من الممكن إصدار حالة مشوهة (`emit` a malformed state) يمكن أن تؤدي إلى أخطاء. الخصائص الخاصة بحالات معينة قابلة للقيمة الفارغة، مما قد يكون مرهقًا للإدارة ويتطلب إما فك التغليف القسري (force unwrapping) أو إجراء فحوصات القيمة الفارغة (null checks). يمكن التخفيف من بعض هذه السلبيات عن طريق كتابة اختبارات الوحدة (unit tests) وكتابة مُنشئات مُتخصصة ومُسماة.
-   **متضخم (Bloated)**: ينتج عنه حالة واحدة يمكن أن تصبح متضخمة بالعديد من الخصائص بمرور الوقت.

#### الحكم (Verdict)

يعمل هذا الأسلوب بشكل أفضل للحالات البسيطة أو عندما تتطلب المتطلبات حالات ليست حصرية (على سبيل المثال، إظهار شريط رسائل (snackbar) عند حدوث خطأ مع الاستمرار في عرض البيانات القديمة من آخر حالة نجاح). يوفر هذا الأسلوب المرونة والإيجاز على حساب أمان النوع.

## الفئة المختومة والفئات الفرعية (Sealed Class and Subclasses)

يتكون هذا الأسلوب من **فئة مختومة (sealed class)** تحمل أي خصائص مشتركة وفئات فرعية متعددة للحالات المنفصلة. هذا الأسلوب رائع للحالات المنفصلة والحصرية.

<SealedClassAndSubclassesSnippet />

#### الإيجابيات (Pros)

-   **آمن من حيث النوع (Type Safe)**: الكود آمن من حيث التجميع (compile-safe) وليس من الممكن الوصول عن طريق الخطأ إلى خاصية غير صالحة. تحمل كل فئة فرعية خصائصها الخاصة، مما يجعل من الواضح أي الخصائص تنتمي إلى أي حالة.
-   **صريح (Explicit)**: يفصل الخصائص المشتركة عن الخصائص الخاصة بالحالة.
-   **شامل (Exhaustive)**: استخدام عبارة `switch` لفحوصات الشمول (exhaustiveness checks) لضمان التعامل مع كل حالة بشكل صريح.
    -   إذا كنت لا تريد [التبديل الشامل (exhaustive switching)](https://dart.dev/language/branches#exhaustiveness-checking) أو تريد أن تكون قادرًا على إضافة أنواع فرعية لاحقًا دون كسر واجهة برمجة التطبيقات (API)، فاستخدم مُعدِّل [final](https://dart.dev/language/class-modifiers#final).
    -   راجع [توثيق الفئة المختومة (sealed class documentation)](https://dart.dev/language/class-modifiers#sealed) لمزيد من التفاصيل.

#### السلبيات (Cons)

-   **مطول (Verbose)**: يتطلب المزيد من الكود (فئة أساسية واحدة وفئة فرعية لكل حالة). قد يتطلب أيضًا كودًا مكررًا للخصائص المشتركة عبر الفئات الفرعية.
-   **معقد (Complex)**: تتطلب إضافة خصائص جديدة تحديث كل فئة فرعية والفئة الأساسية، مما قد يكون مرهقًا ويؤدي إلى زيادة في تعقيد الحالة. بالإضافة إلى ذلك، قد يتطلب فحوصات نوع غير ضرورية/مفرطة للوصول إلى الخصائص.

#### الحكم (Verdict)

يعمل هذا الأسلوب بشكل أفضل للحالات المحددة جيدًا والحصرية ذات الخصائص الفريدة. يوفر هذا الأسلوب أمان النوع وفحوصات الشمول ويؤكد على الأمان على حساب الإيجاز والبساطة.
