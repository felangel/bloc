---
title: Flutter Todos
description: Flutter에서 bloc을 사용하여 todos 앱을 구현하는 심층 가이드.
sidebar:
  order: 6
---

import RemoteCode from '~/components/code/RemoteCode.astro';
import FlutterCreateSnippet from '~/components/tutorials/flutter-todos/FlutterCreateSnippet.astro';
import ActivateVeryGoodCLISnippet from '~/components/tutorials/flutter-todos/ActivateVeryGoodCLISnippet.astro';
import FlutterCreatePackagesSnippet from '~/components/tutorials/flutter-todos/FlutterCreatePackagesSnippet.astro';
import ProjectStructureSnippet from '~/components/tutorials/flutter-todos/ProjectStructureSnippet.astro';
import VeryGoodPackagesGetSnippet from '~/components/tutorials/flutter-todos/VeryGoodPackagesGetSnippet.astro';
import HomePageTreeSnippet from '~/components/tutorials/flutter-todos/HomePageTreeSnippet.astro';
import TodosOverviewPageTreeSnippet from '~/components/tutorials/flutter-todos/TodosOverviewPageTreeSnippet.astro';
import StatsPageTreeSnippet from '~/components/tutorials/flutter-todos/StatsPageTreeSnippet.astro';
import EditTodosPageTreeSnippet from '~/components/tutorials/flutter-todos/EditTodosPageTreeSnippet.astro';

![advanced](https://img.shields.io/badge/level-advanced-red.svg)

이번 튜토리얼에서는 Bloc 라이브러리를 사용하여 Flutter에서 todos 앱을 만들어
봅니다.

![demo](~/assets/tutorials/flutter-todos.gif)

## 주요 주제

- [Bloc과 Cubit](/ko/bloc-concepts#cubit-vs-bloc)을 사용한 다양한 기능 상태
  관리.
- 관심사 분리와 재사용성을 위한 [레이어드 아키텍처](/ko/architecture).
- 상태 변화를 관찰하기 위한 [BlocObserver](/ko/bloc-concepts#blocobserver).
- [BlocProvider](/ko/flutter-bloc-concepts#blocprovider), 자식에게 bloc을
  제공하는 Flutter 위젯.
- [BlocBuilder](/ko/flutter-bloc-concepts#blocbuilder), 새로운 상태에 따라
  위젯을 빌드하는 Flutter 위젯.
- [BlocListener](/ko/flutter-bloc-concepts#bloclistener), 상태 변화에 따라
  사이드 이펙트를 수행하는 Flutter 위젯.
- [RepositoryProvider](/ko/flutter-bloc-concepts#repositoryprovider), 자식에게
  리포지토리를 제공하는 Flutter 위젯.
- [Equatable](/ko/faqs#언제-equatable를-사용해야-하나요)을 사용한 불필요한
  리빌드 방지.
- [MultiBlocListener](/ko/flutter-bloc-concepts#multibloclistener), 여러
  BlocListener 사용 시 중첩을 줄이는 Flutter 위젯.

## 설정

[very_good_cli](https://pub.dev/packages/very_good_cli)를 사용하여 새 Flutter
프로젝트를 생성합니다.

<FlutterCreateSnippet />

:::note

다음 명령으로 `very_good_cli`를 설치할 수 있습니다

<ActivateVeryGoodCLISnippet />

:::

다음으로 `very_good_cli`를 사용하여 `todos_api`, `local_storage_todos_api`,
`todos_repository` 패키지를 생성합니다:

<FlutterCreatePackagesSnippet />

그런 다음 `pubspec.yaml`의 내용을 다음으로 교체합니다:

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/pubspec.yaml"
	title="pubspec.yaml"
/>

마지막으로 모든 의존성을 설치합니다:

<VeryGoodPackagesGetSnippet />

## 프로젝트 구조

애플리케이션의 프로젝트 구조는 다음과 같습니다:

<ProjectStructureSnippet />

프로젝트를 여러 패키지로 분리하여 각 패키지가 명확한 경계와 함께 명시적 의존성을
갖도록 합니다. 이는
[단일 책임 원칙](https://en.wikipedia.org/wiki/Single-responsibility_principle)을
따릅니다. 이렇게 프로젝트를 모듈화하면 다음과 같은 이점이 있습니다:

- 여러 프로젝트에서 패키지를 쉽게 재사용
- CI/CD 효율성 향상 (변경된 코드에 대해서만 검사 실행)
- 전용 테스트 스위트, 시맨틱 버저닝, 릴리스 주기로 패키지를 독립적으로 유지보수
  가능

## 아키텍처

![Todos Architecture Diagram](~/assets/tutorials/todos-architecture.png)

코드를 레이어로 분리하는 것은 매우 중요하며 빠르고 자신감 있게 반복 작업을 할 수
있게 해줍니다. 각 레이어는 단일 책임을 가지며 독립적으로 사용하고 테스트할 수
있습니다. 이를 통해 변경 사항을 특정 레이어에 한정하여 전체 애플리케이션에
미치는 영향을 최소화할 수 있습니다. 또한 애플리케이션을 레이어로 분리하면 여러
프로젝트에서 라이브러리를 쉽게 재사용할 수 있습니다(특히 데이터 레이어).

애플리케이션은 세 가지 주요 레이어로 구성됩니다:

- 데이터 레이어
- 도메인 레이어
- 기능 레이어
  - 프레젠테이션/UI (위젯)
  - 비즈니스 로직 (bloc/cubit)

**데이터 레이어**

이 레이어는 가장 낮은 레이어로 데이터베이스, API 등의 외부 소스에서 원시
데이터를 가져오는 역할을 합니다. 데이터 레이어의 패키지는 일반적으로 UI에
의존하지 않으며 [pub.dev](https://pub.dev)에 독립적인 패키지로 재사용하거나
게시할 수 있습니다. 이 예제에서 데이터 레이어는 `todos_api`와
`local_storage_todos_api` 패키지로 구성됩니다.

**도메인 레이어**

이 레이어는 하나 이상의 데이터 프로바이더를 결합하고 데이터에 "비즈니스 규칙"을
적용합니다. 이 레이어의 각 컴포넌트는 리포지토리라고 하며, 각 리포지토리는
일반적으로 단일 도메인을 관리합니다. 리포지토리 레이어의 패키지는 일반적으로
데이터 레이어와만 상호작용해야 합니다. 이 예제에서 리포지토리 레이어는
`todos_repository` 패키지로 구성됩니다.

**기능 레이어**

이 레이어는 애플리케이션별 기능과 유스케이스를 포함합니다. 각 기능은 일반적으로
UI와 비즈니스 로직으로 구성됩니다. 기능은 일반적으로 다른 기능과 독립적이어야
하며, 나머지 코드베이스에 영향을 주지 않고 쉽게 추가/제거할 수 있어야 합니다. 각
기능 내에서 기능의 상태와 비즈니스 로직은 bloc으로 관리됩니다. Bloc은 0개 이상의
리포지토리와 상호작용합니다. Bloc은 이벤트에 반응하고 UI 변경을 트리거하는
상태를 방출합니다. 각 기능 내의 위젯은 일반적으로 해당 bloc에만 의존하고 현재
상태를 기반으로 UI를 렌더링해야 합니다. UI는 이벤트를 통해 bloc에 사용자 입력을
알릴 수 있습니다. 이 예제에서 애플리케이션은 `home`, `todos_overview`, `stats`,
`edit_todos` 기능으로 구성됩니다.

레이어에 대한 개요를 살펴봤으니 이제 데이터 레이어부터 시작하여 애플리케이션을
만들어 봅시다!

## 데이터 레이어

데이터 레이어는 애플리케이션의 가장 낮은 레이어로 원시 데이터 프로바이더로
구성됩니다. 이 레이어의 패키지는 주로 데이터가 어디서/어떻게 오는지에 관심을
둡니다. 이 경우 데이터 레이어는 인터페이스인 `TodosApi`와 `shared_preferences`를
기반으로 `TodosApi`를 구현한 `LocalStorageTodosApi`로 구성됩니다.

### TodosApi

`todos_api` 패키지는 todos와 상호작용/관리하기 위한 제네릭 인터페이스를
내보냅니다. 나중에 `shared_preferences`를 사용하여 `TodosApi`를 구현할 것입니다.
추상화를 통해 애플리케이션의 다른 부분을 변경하지 않고도 다른 구현을 쉽게 지원할
수 있습니다. 예를 들어, 나중에 `shared_preferences` 대신 `cloud_firestore`를
사용하는 `FirestoreTodosApi`를 최소한의 코드 변경으로 추가할 수 있습니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/todos_api/pubspec.yaml"
	title="packages/todos_api/pubspec.yaml"
/>

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/todos_api/lib/src/todos_api.dart"
	title="packages/todos_api/lib/src/todos_api.dart"
/>

#### Todo 모델

다음으로 `Todo` 모델을 정의합니다.

첫 번째로 주목할 점은 `Todo` 모델이 앱에 있지 않다는 것입니다 — `todos_api`
패키지의 일부입니다. 이는 `TodosApi`가 `Todo` 객체를 반환/수락하는 API를
정의하기 때문입니다. 모델은 저장/검색될 원시 Todo 객체의 Dart 표현입니다.

`Todo` 모델은 json (역)직렬화를 처리하기 위해
[json_serializable](https://pub.dev/packages/json_serializable)을 사용합니다.
따라 하는 경우 컴파일러 오류를 해결하려면
[코드 생성 단계](https://pub.dev/packages/json_serializable#running-the-code-generator)를
실행해야 합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/todos_api/lib/src/models/todo.dart"
	title="packages/todos_api/lib/src/models/todo.dart"
/>

`json_map.dart`는 코드 검사 및 린팅을 위한 `typedef`를 제공합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/todos_api/lib/src/models/json_map.dart"
	title="packages/todos_api/lib/src/models/json_map.dart"
/>

`Todo` 모델은 `todos_api/models/todo.dart`에 정의되어 있으며
`package:todos_api/todos_api.dart`에서 내보냅니다.

#### Export 업데이트

`Todo` 모델과 `TodosApi`는 배럴 파일을 통해 내보냅니다. 모델을 직접 임포트하지
않고 `lib/src/todos_api.dart`에서 패키지 배럴 파일을 참조하여 임포트합니다:
`import 'package:todos_api/todos_api.dart';`. 나머지 임포트 오류를 해결하기 위해
배럴 파일을 업데이트합니다:

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/todos_api/lib/src/models/models.dart"
	title="packages/todos_api/lib/src/models/models.dart"
/>

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/todos_api/lib/todos_api.dart"
	title="packages/todos_api/lib/todos_api.dart"
/>

#### Stream vs Future

이 튜토리얼의 이전 버전에서는 `TodosApi`가 `Stream` 기반이 아닌 `Future`
기반이었습니다.

`Future` 기반 API의 예시는
[Brian Egan의 Architecture Samples 구현](https://github.com/brianegan/flutter_architecture_samples/tree/master/todos_repository_core)을
참고하세요.

`Future` 기반 구현은 두 개의 메서드로 구성될 수 있습니다: `loadTodos`와
`saveTodos`(복수형에 주목). 이는 매번 메서드에 전체 todos 목록을 제공해야 한다는
의미입니다.

- 이 접근 방식의 한계 중 하나는 표준 CRUD(Create, Read, Update, Delete) 작업이
  매번 전체 todos 목록을 보내야 한다는 것입니다. 예를 들어, Todo 추가 화면에서
  추가된 todo 항목만 보낼 수 없습니다. 대신 전체 목록을 추적하고 업데이트된
  목록을 저장할 때 전체 새 todos 목록을 제공해야 합니다.
- 두 번째 한계는 `loadTodos`가 일회성 데이터 전달이라는 것입니다. 앱에는
  주기적으로 업데이트를 요청하는 로직이 포함되어야 합니다.

현재 구현에서 `TodosApi`는 `getTodos()`를 통해 `Stream<List<Todo>>`를 노출하며,
todos 목록이 변경되면 모든 구독자에게 실시간 업데이트를 보고합니다.

또한 todos는 개별적으로 생성, 삭제, 업데이트할 수 있습니다. 예를 들어, todo
삭제와 저장 모두 `todo`만 인자로 사용합니다. 매번 새로 업데이트된 todos 목록을
제공할 필요가 없습니다.

### LocalStorageTodosApi

이 패키지는 [`shared_preferences`](https://pub.dev/packages/shared_preferences)
패키지를 사용하여 `todos_api`를 구현합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/local_storage_todos_api/pubspec.yaml"
	title="packages/local_storage_todos_api/pubspec.yaml"
/>

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/local_storage_todos_api/lib/src/local_storage_todos_api.dart"
	title="packages/local_storage_todos_api/lib/src/local_storage_todos_api.dart"
/>

## 리포지토리 레이어

[리포지토리](/ko/architecture#repository)는 비즈니스 레이어의 일부입니다.
리포지토리는 비즈니스 가치가 없는 하나 이상의 데이터 프로바이더에 의존하며,
그들의 공개 API를 비즈니스 가치를 제공하는 API로 결합합니다. 또한 리포지토리
레이어를 가지면 애플리케이션의 나머지 부분에서 데이터 획득을 추상화하여 앱의
다른 부분에 영향을 주지 않고 데이터가 어디서/어떻게 저장되는지 변경할 수
있습니다.

### TodosRepository

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/todos_repository/lib/src/todos_repository.dart"
	title="packages/todos_repository/lib/src/todos_repository.dart"
/>

리포지토리를 인스턴스화하려면 이 튜토리얼 앞부분에서 논의한 `TodosApi`를
지정해야 하므로 `pubspec.yaml`에 의존성으로 추가했습니다:

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/todos_repository/pubspec.yaml"
	title="packages/todos_repository/pubspec.yaml"
/>

#### 라이브러리 Export

`TodosRepository` 클래스 외에도 `todos_api` 패키지의 `Todo` 모델도 내보냅니다.
이 단계는 애플리케이션과 데이터 프로바이더 간의 긴밀한 결합을 방지합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/packages/todos_repository/lib/todos_repository.dart"
	title="packages/todos_repository/lib/todos_repository.dart"
/>

이 경우 데이터 모델을 완전히 제어할 수 있기 때문에 `todos_repository`에 별도의
모델을 재정의하지 않고 `todos_api`에서 동일한 `Todo` 모델을 재내보내기로
했습니다. 많은 경우 데이터 프로바이더는 제어할 수 없는 것일 수 있습니다. 그러한
경우에는 인터페이스와 API 계약을 완전히 제어하기 위해 리포지토리 레이어에서 자체
모델 정의를 유지하는 것이 더욱 중요해집니다.

## 기능 레이어

### 진입점

앱의 진입점은 `main.dart`입니다. 이 경우 세 가지 버전이 있습니다:

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/main_development.dart"
	title="lib/main_development.dart"
/>

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/main_staging.dart"
	title="lib/main_staging.dart"
/>

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/main_production.dart"
	title="lib/main_production.dart"
/>

가장 주목할 점은 `local_storage_todos_api`의 구체적인 구현이 각 진입점 내에서
인스턴스화된다는 것입니다.

### 부트스트래핑

`bootstrap.dart`는 `BlocObserver`를 로드하고 `TodosRepository` 인스턴스를
생성합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/bootstrap.dart"
	title="lib/bootstrap.dart"
/>

### App

`App`은 모든 자식에게 리포지토리를 제공하는 `RepositoryProvider` 위젯을
감쌉니다. `EditTodoPage`와 `HomePage` 서브트리 모두 자손이므로 모든 bloc과
cubit이 리포지토리에 접근할 수 있습니다.

`AppView`는 `MaterialApp`을 생성하고 테마와 로컬라이제이션을 구성합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/app/app.dart"
	title="lib/app/app.dart"
/>

### Theme

라이트 모드와 다크 모드에 대한 테마 정의를 제공합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/theme/theme.dart"
	title="lib/theme/theme.dart"
/>

### Home

home 기능은 현재 선택된 탭의 상태를 관리하고 올바른 서브트리를 표시하는 역할을
합니다.

#### HomeState

두 화면인 `todos`와 `stats`에 연결된 두 가지 상태만 있습니다.

:::note

`EditTodo`는 별도의 라우트이므로 `HomeState`의 일부가 아닙니다.

:::

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/home/cubit/home_state.dart"
	title="lib/home/cubit/home_state.dart"
/>

#### HomeCubit

비즈니스 로직이 단순하기 때문에 이 경우 cubit이 적합합니다. 탭을 변경하는
`setTab` 메서드 하나가 있습니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/home/cubit/home_cubit.dart"
	title="lib/home/cubit/home_cubit.dart"
/>

#### HomeView

`view.dart`는 home 기능에 대한 모든 관련 UI 컴포넌트를 내보내는 배럴 파일입니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/home/view/view.dart"
	title="lib/home/view/view.dart"
/>

`home_page.dart`는 앱이 시작될 때 사용자가 볼 루트 페이지의 UI를 포함합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/home/view/home_page.dart"
	title="lib/home/view/home_page.dart"
/>

`HomePage`의 위젯 트리를 간략하게 나타내면:

<HomePageTreeSnippet />

`HomePage`는 `HomeView`에 `HomeCubit` 인스턴스를 제공합니다. `HomeView`는 탭이
변경될 때마다 선택적으로 리빌드하기 위해 `context.select`를 사용합니다. 이를
통해 mock `HomeCubit`을 제공하고 상태를 스텁하여 `HomeView`를 쉽게 위젯 테스트할
수 있습니다.

`BottomAppBar`는 `HomeCubit`에서 `setTab`을 호출하는 `HomeTabButton` 위젯을
포함합니다. cubit 인스턴스는 `context.read`를 통해 조회하고 cubit 인스턴스에서
적절한 메서드가 호출됩니다.

:::caution

`context.read`는 변경사항을 리슨하지 않으며, `HomeCubit`에 접근하고 `setTab`을
호출하는 데만 사용됩니다.

:::

### TodosOverview

todos overview 기능을 사용하면 사용자가 todos를 생성, 편집, 삭제 및 필터링하여
관리할 수 있습니다.

#### TodosOverviewEvent

`todos_overview/bloc/todos_overview_event.dart`를 만들고 이벤트를 정의합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/bloc/todos_overview_event.dart"
	title="lib/todos_overview/bloc/todos_overview_event.dart"
/>

- `TodosOverviewSubscriptionRequested`: 시작 이벤트입니다. 응답으로 bloc은
  `TodosRepository`의 todos 스트림을 구독합니다.
- `TodosOverviewTodoDeleted`: Todo를 삭제합니다.
- `TodosOverviewTodoCompletionToggled`: todo의 완료 상태를 토글합니다.
- `TodosOverviewToggleAllRequested`: 모든 todos의 완료를 토글합니다.
- `TodosOverviewClearCompletedRequested`: 완료된 모든 todos를 삭제합니다.
- `TodosOverviewUndoDeletionRequested`: 실수로 인한 삭제 등 todo 삭제를 실행
  취소합니다.
- `TodosOverviewFilterChanged`: `TodosViewFilter`를 인자로 받아 필터를 적용하여
  뷰를 변경합니다.

#### TodosOverviewState

`todos_overview/bloc/todos_overview_state.dart`를 만들고 상태를 정의합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/bloc/todos_overview_state.dart"
	title="lib/todos_overview/bloc/todos_overview_state.dart"
/>

`TodosOverviewState`는 todos 목록, 활성 필터, `lastDeletedTodo`, 상태를
추적합니다.

:::note

기본 getter와 setter 외에도 `filteredTodos`라는 커스텀 getter가 있습니다. UI는
`BlocBuilder`를 사용하여 `state.filteredTodos` 또는 `state.todos`에 접근합니다.

:::

#### TodosOverviewBloc

`todos_overview/bloc/todos_overview_bloc.dart`를 만듭니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/bloc/todos_overview_bloc.dart"
	title="lib/todos_overview/bloc/todos_overview_bloc.dart"
/>

:::note

bloc은 내부적으로 `TodosRepository` 인스턴스를 생성하지 않습니다. 대신 생성자를
통해 리포지토리 인스턴스가 주입되는 것에 의존합니다.

:::

##### onSubscriptionRequested

`TodosOverviewSubscriptionRequested`가 추가되면 bloc은 먼저 `loading` 상태를
방출합니다. 응답으로 UI는 로딩 인디케이터를 렌더링할 수 있습니다.

다음으로 `emit.forEach<List<Todo>>( ... )`를 사용하여 `TodosRepository`의 todos
스트림에 대한 구독을 생성합니다.

:::caution

`emit.forEach()`는 리스트에서 사용하는 `forEach()`와 다릅니다. 이 `forEach`는
bloc이 `Stream`을 구독하고 스트림의 각 업데이트마다 새 상태를 방출할 수 있게
합니다.

:::

:::note

이 튜토리얼에서는 `stream.listen`을 직접 호출하지 않습니다.
`await emit.forEach()`는 bloc이 내부적으로 구독을 관리할 수 있게 하는 새로운
패턴입니다.

:::

이제 구독이 처리되었으니 todos 추가, 수정, 삭제와 같은 다른 이벤트를 처리합니다.

##### onTodoSaved

`_onTodoSaved`는 단순히 `_todosRepository.saveTodo(event.todo)`를 호출합니다.

:::note

`onTodoSaved`와 다른 많은 이벤트 핸들러 내에서 `emit`이 호출되지 않습니다. 대신
리포지토리에 알리고 리포지토리가 todos 스트림을 통해 업데이트된 목록을
방출합니다. 자세한 내용은 [데이터 흐름](#데이터-흐름) 섹션을 참조하세요.

:::

##### 실행 취소

실행 취소 기능을 통해 사용자는 마지막으로 삭제된 항목을 복원할 수 있습니다.

`_onTodoDeleted`는 두 가지를 수행합니다. 먼저 삭제할 `Todo`와 함께 새 상태를
방출합니다. 그런 다음 리포지토리 호출을 통해 `Todo`를 삭제합니다.

`_onUndoDeletionRequested`는 UI에서 삭제 취소 요청 이벤트가 올 때 실행됩니다.

`_onUndoDeletionRequested`는 다음을 수행합니다:

- 마지막으로 삭제된 todo의 복사본을 임시 저장합니다.
- `lastDeletedTodo`를 제거하여 상태를 업데이트합니다.
- 삭제를 되돌립니다.

##### 필터링

`_onFilterChanged`는 새 이벤트 필터와 함께 새 상태를 방출합니다.

#### Models

뷰 필터링을 다루는 모델 파일이 하나 있습니다.

`todos_view_filter.dart`는 세 가지 뷰 필터를 나타내는 enum과 필터를 적용하는
메서드입니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/models/todos_view_filter.dart"
	title="lib/todos_overview/models/todos_view_filter.dart"
/>

`models.dart`는 내보내기를 위한 배럴 파일입니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/models/models.dart"
	title="lib/todos_overview/models/models.dart"
/>

다음으로 `TodosOverviewPage`를 살펴봅시다.

#### TodosOverviewPage

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/view/todos_overview_page.dart"
	title="lib/todos_overview/view/todos_overview_page.dart"
/>

`TodosOverviewPage`의 위젯 트리를 간략하게 나타내면:

<TodosOverviewPageTreeSnippet />

`Home` 기능과 마찬가지로 `TodosOverviewPage`는
`BlocProvider<TodosOverviewBloc>`을 통해 서브트리에 `TodosOverviewBloc`
인스턴스를 제공합니다. 이는 `TodosOverviewBloc`의 범위를 `TodosOverviewPage`
아래의 위젯으로만 한정합니다.

`TodosOverviewBloc`의 변경사항을 리슨하는 세 개의 위젯이 있습니다.

1. 첫 번째는 에러를 리슨하는 `BlocListener`입니다. `listener`는 `listenWhen`이
   `true`를 반환할 때만 호출됩니다. 상태가 `TodosOverviewStatus.failure`이면
   `SnackBar`가 표시됩니다.

2. 삭제를 리슨하는 두 번째 `BlocListener`를 만들었습니다. todo가 삭제되면 실행
   취소 버튼이 있는 `SnackBar`가 표시됩니다. 사용자가 실행 취소를 탭하면
   `TodosOverviewUndoDeletionRequested` 이벤트가 bloc에 추가됩니다.

3. 마지막으로 `BlocBuilder`를 사용하여 todos를 표시하는 ListView를 빌드합니다.

`AppBar`에는 todos를 필터링하고 조작하기 위한 드롭다운인 두 가지 액션이
있습니다.

:::note

`TodosOverviewTodoCompletionToggled`와 `TodosOverviewTodoDeleted`는
`context.read`를 통해 bloc에 추가됩니다.

:::

`view.dart`는 `todos_overview_page.dart`를 내보내는 배럴 파일입니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/view/view.dart"
	title="lib/todos_overview/view/view.dart"
/>

#### Widgets

`widgets.dart`는 `todos_overview` 기능 내에서 사용되는 모든 컴포넌트를 내보내는
또 다른 배럴 파일입니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/widgets/widgets.dart"
	title="lib/todos_overview/widgets/widgets.dart"
/>

`todo_list_tile.dart`는 각 todo 항목의 `ListTile`입니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/widgets/todo_list_tile.dart"
	title="lib/todos_overview/widgets/todo_list_tile.dart"
/>

`todos_overview_options_button.dart`는 todos를 조작하기 위한 두 가지 옵션을
노출합니다:

- `toggleAll`
- `clearCompleted`

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/widgets/todos_overview_options_button.dart"
	title="lib/todos_overview/widgets/todos_overview_options_button.dart"
/>

`todos_overview_filter_button.dart`는 세 가지 필터 옵션을 노출합니다:

- `all`
- `activeOnly`
- `completedOnly`

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/todos_overview/widgets/todos_overview_filter_button.dart"
	title="lib/todos_overview/widgets/todos_overview_filter_button.dart"
/>

### Stats

stats 기능은 활성 및 완료된 todos에 대한 통계를 표시합니다.

#### StatsState

`StatsState`는 요약 정보와 현재 `StatsStatus`를 추적합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/stats/bloc/stats_state.dart"
	title="lib/stats/bloc/stats_state.dart"
/>

#### StatsEvent

`StatsEvent`에는 `StatsSubscriptionRequested`라는 하나의 이벤트만 있습니다:

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/stats/bloc/stats_event.dart"
	title="lib/stats/bloc/stats_event.dart"
/>

#### StatsBloc

`StatsBloc`은 `TodosOverviewBloc`과 마찬가지로 `TodosRepository`에 의존합니다.
`_todosRepository.getTodos`를 통해 todos 스트림을 구독합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/stats/bloc/stats_bloc.dart"
	title="lib/stats/bloc/stats_bloc.dart"
/>

#### Stats View

`view.dart`는 `stats_page`를 위한 배럴 파일입니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/stats/view/view.dart"
	title="lib/stats/view/view.dart"
/>

`stats_page.dart`는 todos 통계를 표시하는 페이지의 UI를 포함합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/stats/view/stats_page.dart"
	title="lib/stats/view/stats_page.dart"
/>

`StatsPage`의 위젯 트리를 간략하게 나타내면:

<StatsPageTreeSnippet />

:::caution

`TodosOverviewBloc`과 `StatsBloc`은 모두 `TodosRepository`와 통신하지만, bloc
간에 직접적인 통신은 없다는 점에 유의해야 합니다. 자세한 내용은
[데이터 흐름](#데이터-흐름) 섹션을 참조하세요.

:::

### EditTodo

`EditTodo` 기능을 통해 사용자는 기존 todo 항목을 편집하고 변경사항을 저장할 수
있습니다.

#### EditTodoState

`EditTodoState`는 todo를 편집할 때 필요한 정보를 추적합니다.

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/edit_todo/bloc/edit_todo_state.dart"
	title="lib/edit_todo/bloc/edit_todo_state.dart"
/>

#### EditTodoEvent

bloc이 반응할 다양한 이벤트는 다음과 같습니다:

- `EditTodoTitleChanged`
- `EditTodoDescriptionChanged`
- `EditTodoSubmitted`

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/edit_todo/bloc/edit_todo_event.dart"
	title="lib/edit_todo/bloc/edit_todo_event.dart"
/>

#### EditTodoBloc

`EditTodoBloc`은 `TodosOverviewBloc` 및 `StatsBloc`과 마찬가지로
`TodosRepository`에 의존합니다.

:::caution

다른 Bloc과 달리 `EditTodoBloc`은 `_todosRepository.getTodos`를 구독하지
않습니다. 리포지토리에서 정보를 읽을 필요가 없는 "쓰기 전용" bloc입니다.

:::

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/edit_todo/bloc/edit_todo_bloc.dart"
	title="lib/edit_todo/bloc/edit_todo_bloc.dart"
/>

##### 데이터 흐름

동일한 todos 목록에 의존하는 많은 기능이 있지만, bloc 간 통신은 없습니다. 대신
모든 기능은 서로 독립적이며 todos 목록의 변경사항을 리슨하고 목록을 업데이트하기
위해 `TodosRepository`에 의존합니다.

예를 들어, `EditTodos`는 `TodosOverview`나 `Stats` 기능에 대해 아무것도
모릅니다.

UI가 `EditTodoSubmitted` 이벤트를 제출하면:

- `EditTodoBloc`이 `TodosRepository`를 업데이트하는 비즈니스 로직을 처리합니다.
- `TodosRepository`가 `TodosOverviewBloc`과 `StatsBloc`에 알립니다.
- `TodosOverviewBloc`과 `StatsBloc`이 새 상태로 업데이트하는 UI에 알립니다.

#### EditTodoPage

<RemoteCode
	url="https://raw.githubusercontent.com/felangel/bloc/master/examples/flutter_todos/lib/edit_todo/view/edit_todo_page.dart"
	title="lib/edit_todo/view/edit_todo_page.dart"
/>

이전 기능과 마찬가지로 `EditTodosPage`는 `BlocProvider`를 통해 `EditTodosBloc`
인스턴스를 제공합니다. 다른 기능과 달리 `EditTodosPage`는 별도의 라우트이므로
`static` `route` 메서드를 노출합니다. 이를 통해
`Navigator.of(context).push(...)`를 통해 네비게이션 스택에 `EditTodosPage`를
쉽게 푸시할 수 있습니다.

`EditTodosPage`의 위젯 트리를 간략하게 나타내면:

<EditTodosPageTreeSnippet />

## 요약

튜토리얼을 완료했습니다! 🎉

유닛 테스트와 위젯 테스트를 포함한 전체 소스 코드는
[여기](https://github.com/felangel/bloc/tree/master/examples/flutter_todos)에서
확인할 수 있습니다.
