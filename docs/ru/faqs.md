# –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

## –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

‚ùî**–í–æ–ø—Ä–æ—Å**: –Ø –ø–æ–ª—É—á–∞—é —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Å–≤–æ–µ–º –±–ª–æ–∫–µ, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è. –ß—Ç–æ —è –¥–µ–ª–∞—é –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ?

üí°**–û—Ç–≤–µ—Ç**: –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `Equatable`, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–π—Ç–µ —Å—É–ø–µ—Ä–∫–ª–∞—Å—Å—É –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –≥–µ—Ç—Ç–µ—Ä.

‚úÖ**–•–æ—Ä–æ—à–æ**

```dart
abstract class MyState extends Equatable {
    const MyState();
}

class StateA extends MyState {
    final String property;

    const StateA(this.property);

    @override
    List<Object> get props => [property]; // pass all properties to props
}
```

‚ùå**–ü–ª–æ—Ö–æ**

```dart
abstract class MyState extends Equatable {
    const MyState();
}

class StateA extends MyState {
    final String property;

    const StateA(this.property);

    @override
    List<Object> get props => [];
}
```

```dart
abstract class MyState extends Equatable {
    const MyState();
}

class StateA extends MyState {
    final String property;

    const StateA(this.property);

    @override
    List<Object> get props => null;
}
```

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –≤–∞—à–µ–º –±–ª–æ–∫–µ.

‚úÖ**–•–æ—Ä–æ—à–æ**

```dart
@override
Stream<MyState> mapEventToState(MyEvent event) async* {
    // always create a new instance of the state you are going to yield
    yield state.copyWith(property: event.property);
}
```

```dart
@override
Stream<MyState> mapEventToState(MyEvent event) async* {
    final data = _getData(event.info);
    // always create a new instance of the state you are going to yield
    yield MyState(data: data);
}
```

‚ùå**–ü–ª–æ—Ö–æ**

```dart
@override
Stream<MyState> mapEventToState(MyEvent event) async* {
    // never modify/mutate state
    state.property = event.property;
    // never yield the same instance of state
    yield state;
}
```

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Equatable

‚ùî**–í–æ–ø—Ä–æ—Å**: –ö–æ–≥–¥–∞ —è –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Equatable`?

üí°**–û—Ç–≤–µ—Ç**:

```dart
@override
Stream<MyState> mapEventToState(MyEvent event) async* {
    yield StateA('hi');
    yield StateA('hi');
}
```

–í –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º –≤—ã—à–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –µ—Å–ª–∏ `StateA` —Ä–∞—Å—à–∏—Ä—è–µ—Ç `Equatable`, –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–≤—Ç–æ—Ä–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è).
–í –æ–±—â–µ–º, –≤—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Equatable`, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –∫–æ–¥, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å–±–æ—Ä–æ–∫.
–í—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Equatable` –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ `back-to-back` –≤—ã–∑—ã–≤–∞–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.
–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Equatable` –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ–±–ª–µ–≥—á–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤, —Ç–∞–∫ –∫–∞–∫ –º—ã –º–æ–∂–µ–º –æ–∂–∏–¥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –±–ª–æ–∫–æ–≤, –∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Matchers` –∏–ª–∏ `Predicates`.

```dart
blocTest(
    '...',
    build: () => MyBloc(),
    act: (bloc) => bloc.add(MyEvent()),
    expect: [
        MyStateA(),
        MyStateB(),
    ],
)
```

–ë–µ–∑ `Equatable` –≤—ã—à–µ–ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø–æ—Ç–µ—Ä–ø–∏—Ç –Ω–µ—É–¥–∞—á—É –∏ –µ–≥–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ç–∞–∫:

```dart
blocTest(
    '...',
    build: () => MyBloc(),
    act: (bloc) => bloc.add(MyEvent()),
    expect: [
        isA<MyStateA>(),
        isA<MyStateB>(),
    ],
)
```

## Bloc –ø—Ä–æ—Ç–∏–≤ Redux

‚ùî**–í–æ–ø—Ä–æ—Å**: –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Bloc –∏ Redux?

üí°**–û—Ç–≤–µ—Ç**: `BLoC` - —ç—Ç–æ —à–∞–±–ª–æ–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏:

1. –í—Ö–æ–¥ –∏ –≤—ã—Ö–æ–¥ `BLoC` - —ç—Ç–æ –ø—Ä–æ—Å—Ç—ã–µ `Streams` –∏ `Sinks`.
2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–Ω–µ–¥—Ä—è–µ–º—ã–º–∏ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.
3. –†–∞–∑–≤–µ—Ç–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.
4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫–∞—è —É–≥–æ–¥–Ω–æ, –µ—Å–ª–∏ –≤—ã –±—É–¥–µ—Ç–µ —Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–º –≤—ã—à–µ –ø—Ä–∞–≤–∏–ª–∞–º.

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

1. –ö–∞–∂–¥—ã–π `–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª–æ–∂–Ω—ã–π` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `BLoC`
2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ "–∫–∞–∫ –µ—Å—Ç—å"
3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∫ –º–æ–∂–Ω–æ –±–ª–∏–∂–µ –∫ ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª
4. –í—Å–µ –≤–µ—Ç–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –æ—Å–Ω–æ–≤—ã–≤–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—Å—Ç—ã—Ö –±—É–ª–µ–≤—ã—Ö –≤—ã—Ö–æ–¥–∞—Ö `BLoC`

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `Bloc` —Ä–µ–∞–ª–∏–∑—É–µ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `BLoC` –∏ —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞—Ç—å `RxDart` –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

–¢—Ä–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞ Redux:

1. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
2. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è
3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ–ª–∞—é—Ç—Å—è —á–∏—Å—Ç—ã–º–∏ `pure` —Ñ—É–Ω–∫—Ü–∏—è–º–∏

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `Bloc` –Ω–∞—Ä—É—à–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø—Ä–∏–Ω—Ü–∏–ø; —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –±–ª–æ–∫–∞–º.
–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤ –±–ª–æ–∫–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—è `middleware` —É—Ä–æ–≤–Ω—è –∏ `bloc` —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –∏ –ª–µ–≥–∫–æ–≥–æ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø–æ–∑–≤–æ–ª—è—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.

## Bloc –ø—Ä–æ—Ç–∏–≤ Provider

‚ùî**–í–æ–ø—Ä–æ—Å**: –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `Bloc` –∏ `Provider`?

üí°**–û—Ç–≤–µ—Ç**: `Provider` —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç `InheritedWidget`).
–í–∞–º —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –≤—ã—è—Å–Ω–∏—Ç—å –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–∞—à–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (—á–µ—Ä–µ–∑ `ChangeNotifier`, `Bloc`, `Mobx` –∏ —Ç.–¥.). –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `Bloc` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Provider` –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ, —á—Ç–æ–±—ã —É–ø—Ä–æ—Å—Ç–∏—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏ –¥–æ—Å—Ç—É–ø –∫ –±–ª–æ–∫–∞–º –ø–æ –≤—Å–µ–º—É –¥–µ—Ä–µ–≤—É –≤–∏–¥–∂–µ—Ç–æ–≤.

## –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å Bloc

‚ùî**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫ –º–Ω–µ —Å–¥–µ–ª–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å `Bloc`?

üí°**–û—Ç–≤–µ—Ç**: –û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å [–ù–∞–≤–∏–≥–∞—Ü–∏—è –≤–æ Flutter](ru/recipesflutternavigation.md)

## BlocProvider.of() –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç Bloc

‚ùî**–í–æ–ø—Ä–æ—Å**: –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `BlocProvider.of(context)` –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ `bloc`. –ö–∞–∫ —è –º–æ–≥—É —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?

üí°**–û—Ç–≤–µ—Ç**: –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `bloc` –∏–∑ —Ç–æ–≥–æ –∂–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω –±—ã–ª –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –ø–æ—ç—Ç–æ–º—É –≤—ã –¥–æ–ª–∂–Ω—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `BlocProvider.of()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –¥–æ—á–µ—Ä–Ω–µ–≥–æ `BuildContext`.

‚úÖ**–•–æ—Ä–æ—à–æ**

```dart
@override
Widget build(BuildContext context) {
  BlocProvider(
    create: (_) => BlocA(),
    child: MyChild();
  );
}

class MyChild extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return RaisedButton(
      onPressed: () {
        final blocA = BlocProvider.of<BlocA>(context);
        ...
      },
    )
    ...
  }
}
```

```dart
@override
Widget build(BuildContext context) {
  BlocProvider(
    create: (_) => BlocA(),
    child: Builder(
      builder: (context) => RaisedButton(
        onPressed: () {
          final blocA = BlocProvider.of<BlocA>(context);
          ...
        },
      ),
    ),
  );
}
```

‚ùå**–ü–ª–æ—Ö–æ**

```dart
@override
Widget build(BuildContext context) {
  BlocProvider(
    create: (_) => BlocA(),
    child: RaisedButton(
      onPressed: () {
        final blocA = BlocProvider.of<BlocA>(context);
        ...
      }
    )
  );
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

‚ùî**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫ –º–Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç?

üí°**–û—Ç–≤–µ—Ç**: –•–æ—Ç—è –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å—Å—ã–ª–∫–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –Ω–∏–∂–µ:

- [–ü—Ä–∏–º–µ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Flutter - Brian Egan](https://github.com/brianegan/flutter_architecture_samples/tree/master/bloc_library)
- [Flutter - –ø—Ä–∏–º–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª—è](https://github.com/felangel/bloc/tree/master/examples/flutter_shopping_cart)
- [Flutter TDD –ö—É—Ä—Å - ResoCoder](https://github.com/ResoCoder/flutter-tdd-clean-architecture-course)

–ù–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–º —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ **—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–π** –∏ **–ø—Ä–µ–¥–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–π** —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞.
